<?xml version='1.0' encoding='UTF-8'?>
<rss xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" version="2.0">
  <channel>
    <title>Jay's blog</title>
    <link>https://jaysherby.com/rss/</link>
    <description>&lt;h1 style="font-weight: normal"&gt;&#13;
  Hi! I'm &lt;strong&gt;Jay Sherby&lt;/strong&gt;!&#13;
&lt;/h1&gt;&#13;
&#13;
I'm an experienced software developer in Chicago.&#13;
&#13;
Hiring? Check  to see...</description>
    <atom:link href="https://jaysherby.com/rss/" rel="self"/>
    <docs>http://www.rssboard.org/rss-specification</docs>
    <generator>python-feedgen</generator>
    <item>
      <title>How I Fixed Slow Wifi In Debian 12</title>
      <link>https://jaysherby.com/how-i-fixed-slow-wifi-in-debian-12/</link>
      <description>&lt;p&gt;&lt;a href='https://jaysherby.com/how-i-fixed-laggy-wifi-in-debian-12/'&gt;Last time&lt;/a&gt; I blogged about my home server's wifi connection, I had to disable power management on the wifi adapter to avoid undesirable behavior.&lt;/p&gt;
&lt;p&gt;This time, I was transferring a large quantity of large files from my laptop to my home server, and I noticed the transfer speed was capped at around 3 MB/s. I found that very concerning because although wifi isn't the fastest way to transfer data by a wide margin, it should still be faster than that.&lt;/p&gt;
&lt;p&gt;After a bunch of inspection of various settings using &lt;code&gt;iw list&lt;/code&gt; and &lt;code&gt;iwlist wlp1s0&lt;/code&gt;, I discovered the problem. By looking at frequency and channel settings, I saw that my adapter was connecting to my router at 2.4 Ghz frequencies instead of the 5 GHz frequencies I wanted.&lt;/p&gt;
&lt;p&gt;A bunch of googling suggested passing a &lt;code&gt;freq_list&lt;/code&gt; property to wpa_supplicant in its config file. One problem: I'm not configuring wpa_supplication via a config file. I'm configuring it via my &lt;code&gt;/etc/network/interfaces&lt;/code&gt; file. I was already using the &lt;code&gt;wpa-ssid&lt;/code&gt; and &lt;code&gt;wpa-psk&lt;/code&gt; options. Is there an equivalent option to pass in a frequency list?&lt;/p&gt;
&lt;p&gt;&lt;a href='https://superuser.com/q/678194'&gt;Yes&lt;/a&gt;, but it's not very well-documented. The magic happens in the &lt;code&gt;/etc/wpa_supplicant/functions.sh&lt;/code&gt; file. The appropriate option is &lt;code&gt;wpa-freq-list&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Here's what my &lt;code&gt;/etc/network/interfaces&lt;/code&gt; file looks like:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

source /etc/network/interfaces.d/*

# The loopback network interface
auto lo
iface lo inet loopback

# The primary network interface
allow-hotplug wlp1s0
iface wlp1s0 inet dhcp
	wpa-ssid &amp;lt;ssid&amp;gt;
	wpa-psk &amp;lt;passphrase&amp;gt;
	wpa-freq-list &amp;lt;frequency list&amp;gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Using the &lt;code&gt;iw list&lt;/code&gt; command, I was able to determine that the right list of frequencies for my hardware and desired configuration is the following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;wpa-freq-list 5180 5200 5240 5260 5280 5300 5320 5500 5520 5540 5560 5580 5600 5620 5640 5660 5680 5700 5720 5745 5765 5785 5805 5825
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I encourage you to check your own hardware rather than copying my list of frequencies verbatim.&lt;/p&gt;
&lt;p&gt;After I made this change and restarted the network subsystem, transfers looked much better at around 20 MB/s to 25 MB/s on average.&lt;/p&gt;
</description>
      <author>hidden (jaysherby)</author>
      <guid isPermaLink="false">https://jaysherby.com/how-i-fixed-slow-wifi-in-debian-12/</guid>
      <category>home server</category>
      <category>linux</category>
      <pubDate>Wed, 29 Jan 2025 03:17:00 +0000</pubDate>
    </item>
    <item>
      <title>How I Fixed Laggy Wifi In Debian 12</title>
      <link>https://jaysherby.com/how-i-fixed-laggy-wifi-in-debian-12/</link>
      <description>&lt;p&gt;The time has finally come to replace my Raspberry Pi 4 home server with something a little more capable. It's been dutifully chugging along for more than 4 years, but my needs finally exceed its capabilities.&lt;/p&gt;
&lt;p&gt;I got a good deal on a Lenovo ThinkCentre M910q from &lt;a href='https://www.backmarket.com/'&gt;Back Market&lt;/a&gt;. When I went to install Debian 12 Bookworm, I found that Debian's non-free firmware packages don't include the necessary drivers for the cheap USB wifi adapter the seller included. Rather than faff about trying to compile and install the kernel module, I bought an Intel 8265 M.2 wifi adapter from Amazon. Its drivers are included in Debian's non-free firmware, and according to Lenovo's service manuals, this was the model they would have included in my machine had that option been chosen during configuration.&lt;/p&gt;
&lt;p&gt;Installation of Debian worked without any issues. However, once the system was running, I noticed SSH sessions were very laggy. Pings to the new machine were averaging around 150 milliseconds, which is ten times longer than pings to the Raspberry Pi it was set to replace.&lt;/p&gt;
&lt;p&gt;After a little searching online, I found the culprit to be the power management on the wifi adapter. I think the wifi adapter goes into a low-power state after a lull in network traffic, but the lull is so short that the time between key presses in a SSH session is enough to trigger it. Because this device is not running on a battery, I feel comfortable turning the wifi adapter's power management off. This appears the solve the issue, and my SSH sessions are properly peppy afterwards.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;server-user@m910q:~$ sudo iw dev wlp1s0 set power_save off
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;However, there's still a problem. If the system reboots, the power management for the wifi adapter returns to its default state of being turned on.&lt;/p&gt;
&lt;p&gt;Systemd to the rescue. After debugging some examples online that are very close to correct but ultimately out of date, here's the unit file I ended up with and the commands I used to set it up for my wifi adapter.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo systemctl --full --force edit wlan_always_on@.service
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;[Unit]&lt;/span&gt;
&lt;span class="na"&gt;Description&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;Keep wireless device %i from sleeping.&lt;/span&gt;
&lt;span class="na"&gt;After&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;network.target&lt;/span&gt;

&lt;span class="k"&gt;[Service]&lt;/span&gt;
&lt;span class="na"&gt;ExecStart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/usr/sbin/iw dev %i set power_save off&lt;/span&gt;

&lt;span class="k"&gt;[Install]&lt;/span&gt;
&lt;span class="na"&gt;WantedBy&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;default.target&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo systemctl enable --now wlan_always_on@wlp1s0.service
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This setup may not be perfect. I'm no systemd expect. This is cobbled and cargo culted together. But it works on my machineâ„¢.&lt;/p&gt;
</description>
      <author>hidden (jaysherby)</author>
      <guid isPermaLink="false">https://jaysherby.com/how-i-fixed-laggy-wifi-in-debian-12/</guid>
      <category>home server</category>
      <category>linux</category>
      <category>systemd</category>
      <pubDate>Wed, 21 Feb 2024 04:21:55 +0000</pubDate>
    </item>
  </channel>
</rss>
