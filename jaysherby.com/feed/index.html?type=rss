<?xml version='1.0' encoding='UTF-8'?>
<rss xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" version="2.0">
  <channel>
    <title>Jay's blog</title>
    <link>https://jaysherby.com</link>
    <description>&lt;h1 style="font-weight: normal"&gt;&#13;
  Hi! I'm &lt;strong&gt;Jay Sherby&lt;/strong&gt;!&#13;
&lt;/h1&gt;&#13;
&#13;
I'm an experienced software developer in Chicago.&#13;
&#13;
Hiring? Check  to see...</description>
    <atom:link href="https://jaysherby.com/feed/?type=rss" rel="self" type="application/rss+xml"/>
    <docs>http://www.rssboard.org/rss-specification</docs>
    <generator>python-feedgen</generator>
    <item>
      <title>Auto Update Podman Quadlet Images</title>
      <link>https://jaysherby.com/auto-update-podman-quadlet-images/</link>
      <description>&lt;p&gt;I &lt;a href='https://jaysherby.com/from-docker-compose-to-quadlets/'&gt;recently&lt;/a&gt; wrote about moving from Docker Compose to Podman Quadlets. I haven't had any issues with the configuration so far, but I did make one change today.&lt;/p&gt;
&lt;p&gt;My old setup made it easy to pull newer versions of images when I wanted by running &lt;code&gt;docker compose down&lt;/code&gt; followed by &lt;code&gt;docker compose up --pull=always -d&lt;/code&gt; to actually pull new images and restart the services. It was a manual process, but it was easy.&lt;/p&gt;
&lt;p&gt;Today, I looked into how I'd accomplish the equivalent action for my Podman Quadlets. It turns out that Podman has a fancy way to do this more or less automatically.&lt;/p&gt;
&lt;p&gt;First, you must enable a systemd timer that Podman provides for doing automatic updates.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;systemctl&lt;span class="w"&gt; &lt;/span&gt;--user&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nb"&gt;enable&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;--now&lt;span class="w"&gt; &lt;/span&gt;podman-auto-update.timer
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that I'm enabling this timer &lt;em&gt;at the user level&lt;/em&gt;.  That's important since my Quadlets are also user level. The timer needs to run at the same level as the Quadlet services.&lt;/p&gt;
&lt;p&gt;Second, update the Quadlet files so that &lt;code&gt;AutoUpdate=registry&lt;/code&gt; is added in the &lt;code&gt;[Container]&lt;/code&gt; section of the file.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# /home/server-user/.config/containers/systemd/plex.container&lt;/span&gt;
&lt;span class="k"&gt;[Unit]&lt;/span&gt;
&lt;span class="na"&gt;Description&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;Plex Media Server&lt;/span&gt;
&lt;span class="na"&gt;After&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;network.target&lt;/span&gt;

&lt;span class="k"&gt;[Container]&lt;/span&gt;
&lt;span class="na"&gt;Image&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;lscr.io/linuxserver/plex:latest&lt;/span&gt;
&lt;span class="na"&gt;AutoUpdate&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;registry&lt;/span&gt;

&lt;span class="na"&gt;Network&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;host&lt;/span&gt;
&lt;span class="na"&gt;UserNS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;keep-id&lt;/span&gt;

&lt;span class="na"&gt;Environment&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;TZ=America/Chicago&lt;/span&gt;
&lt;span class="na"&gt;Environment&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;VERSION=docker&lt;/span&gt;
&lt;span class="na"&gt;Environment&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;PLEX_CLAIM=[REDACTED]&lt;/span&gt;

&lt;span class="na"&gt;Volume&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/home/server-user/plex/config:/config:Z&lt;/span&gt;
&lt;span class="na"&gt;Volume&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/media/wd-gold/Television:/tv:Z&lt;/span&gt;
&lt;span class="na"&gt;Volume&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/media/wd-gold/Movies:/movies:Z&lt;/span&gt;

&lt;span class="na"&gt;AddDevice&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/dev/dri:/dev/dri&lt;/span&gt;
&lt;span class="na"&gt;PublishPort&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;32400:32400/tcp&lt;/span&gt;

&lt;span class="k"&gt;[Service]&lt;/span&gt;
&lt;span class="na"&gt;Restart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;always&lt;/span&gt;

&lt;span class="k"&gt;[Install]&lt;/span&gt;
&lt;span class="na"&gt;WantedBy&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;default.target&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# /home/server-user/.config/containers/systemd/tiddlywiki.container&lt;/span&gt;
&lt;span class="k"&gt;[Unit]&lt;/span&gt;
&lt;span class="na"&gt;Description&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;TiddlyWiki&lt;/span&gt;
&lt;span class="na"&gt;After&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;network.target&lt;/span&gt;

&lt;span class="k"&gt;[Container]&lt;/span&gt;
&lt;span class="na"&gt;Image&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;docker.io/library/node:lts-alpine&lt;/span&gt;
&lt;span class="na"&gt;AutoUpdate&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;registry&lt;/span&gt;

&lt;span class="na"&gt;UserNS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;keep-id&lt;/span&gt;

&lt;span class="na"&gt;Exec&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;npx --yes tiddlywiki /wiki --listen host=0.0.0.0 port=8080&lt;/span&gt;

&lt;span class="na"&gt;Volume&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/home/server-user/wiki:/wiki:Z&lt;/span&gt;

&lt;span class="na"&gt;PublishPort&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;80:8080/tcp&lt;/span&gt;

&lt;span class="k"&gt;[Service]&lt;/span&gt;
&lt;span class="na"&gt;Restart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;always&lt;/span&gt;

&lt;span class="k"&gt;[Install]&lt;/span&gt;
&lt;span class="na"&gt;WantedBy&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;default.target&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;After updating the Quadlets, reload the systemd daemon and restart the services, and everything should be ready to go. Podman should check for new images daily and restart the services when appropriate.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;systemctl&lt;span class="w"&gt; &lt;/span&gt;--user&lt;span class="w"&gt; &lt;/span&gt;daemon-reload

systemctl&lt;span class="w"&gt; &lt;/span&gt;restart&lt;span class="w"&gt; &lt;/span&gt;--user&lt;span class="w"&gt; &lt;/span&gt;plex.service

systemctl&lt;span class="w"&gt; &lt;/span&gt;restart&lt;span class="w"&gt; &lt;/span&gt;--user&lt;span class="w"&gt; &lt;/span&gt;tiddlywiki.service
&lt;/pre&gt;&lt;/div&gt;
</description>
      <author>hidden (jaysherby)</author>
      <guid isPermaLink="false">https://jaysherby.com/auto-update-podman-quadlet-images/</guid>
      <category>home server</category>
      <category>podman</category>
      <category>systemd</category>
      <pubDate>Sun, 02 Nov 2025 03:47:31 +0000</pubDate>
    </item>
    <item>
      <title>From Docker Compose to Quadlets</title>
      <link>https://jaysherby.com/from-docker-compose-to-quadlets/</link>
      <description>&lt;p&gt;I recently migrated my home server from Debian 12 to 13 and I decided to ditch Docker for Podman. I've written about some of the differences when moving from Docker to Podman &lt;a href='https://jaysherby.com/tips-for-becoming-a-pod-person/'&gt;previously&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Here's my old &lt;code&gt;docker-compose.yml&lt;/code&gt; file:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;services&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;plex&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;lscr.io/linuxserver/plex:latest&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;container_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;plex&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="c1"&gt;# Host networking is simpler than trying to forward everything&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;network_mode&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;host&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;environment&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;TZ=America/Chicago&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;VERSION=docker&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;PUID=1000&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;PGID=1000&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;PLEX_CLAIM=&amp;lt;REDACTED&amp;gt;&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;volumes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;/home/server-user/plex/config:/config&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;/media/wd-gold/Television:/tv&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;/media/wd-gold/Movies:/movies&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;devices&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;/dev/dri:/dev/dri&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;restart&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;unless-stopped&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;32400:32400/tcp&lt;/span&gt;

&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;tiddlywiki&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;node:lts-alpine&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;container_name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;tiddlywiki&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;entrypoint&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;npx --yes tiddlywiki /wiki --listen host=0.0.0.0 port=8080 debug-level=debug&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;healthcheck&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nt"&gt;test&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;wget -q --spider -o /dev/null 127.0.0.1:8080 || exit 1&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nt"&gt;interval&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;60s&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nt"&gt;timeout&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;5s&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;volumes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;/home/server-user/wiki:/wiki&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;restart&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;unless-stopped&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="p p-Indicator"&gt;-&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="l l-Scalar l-Scalar-Plain"&gt;80:8080/tcp&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I've got a Plex server, and a TiddlyWiki running on port 80. This is not a particularly apt use of Docker Compose since I'm only really using it because it's familiar and it lets me bring the server up and down with a single command.&lt;/p&gt;
&lt;p&gt;To move to Podman, I tried what I thought would be the path of least resistance: Podman Compose. It wasn't as turn-key as I would have expected. Because Podman doesn't use a root daemon like Docker, all of my containers would die when I logged out of my user. This wasn't an issue when I used Docker since Docker's daemon was always running. To keep my user session alive, I could have chosen something like &lt;code&gt;nohup&lt;/code&gt;, &lt;code&gt;screen&lt;/code&gt;, or &lt;code&gt;tmux&lt;/code&gt;. I chose instead to turn on lingering for the user with systemd.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;sudo&lt;span class="w"&gt; &lt;/span&gt;loginctl&lt;span class="w"&gt; &lt;/span&gt;enable-linger&lt;span class="w"&gt; &lt;/span&gt;server-user
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Yes, &lt;a href='https://www.youtube.com/watch?v=G6Kspj3OO0s'&gt;I have to let it linger&lt;/a&gt;. RIP Dolores O'Riordan.&lt;/p&gt;
&lt;p&gt;This change at least let me continue limping along with Podman Compose until I had to chance to investigate. Because Podman is not daemon-based, &lt;code&gt;restart: unless-stopped&lt;/code&gt; doesn't work. It also means that my containers don't come back up automatically if I reboot the system. Also, my Plex container doesn't get write access to my media library, meaning I can't delete things from the Plex interface. I've tried adding &lt;code&gt;:rw&lt;/code&gt; and &lt;code&gt;:rw,Z&lt;/code&gt; and &lt;code&gt;:rw,z&lt;/code&gt; to those volumes without effect. I think it's probably because Podman Compose is automatically putting everything into a "pod", which is composed of a "Linux network namespace, IPC namespace, and (optionally) PID namespace" that can be shared between containers. There are ways to configure your compose file so that Podman doesn't do this, but the version of Podman Compose present in Debian's repos doesn't understand those options. I'd have to install a newer version of Podman Compose through pip, for example.&lt;/p&gt;
&lt;p&gt;It was about this point when I figured maybe I was using the wrong tool for the job. I decided to try Quadlets instead. They seem to be the preferred way to orchestrate Podman containers. Podman ships with support for Quadlets included. Quadlets are files that share the syntax of systemd unit files. They are run through a generator that generates actual systemd unit files. From there, the containers are managed just like any other user services, using systemd. What do you expect? Systemd and Podman both come from the folks at &lt;del&gt;Red Hat&lt;/del&gt; IBM.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# /home/server-user/.config/containers/systemd/plex.container &lt;/span&gt;
&lt;span class="k"&gt;[Unit]&lt;/span&gt;
&lt;span class="na"&gt;Description&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;Plex Media Server&lt;/span&gt;
&lt;span class="na"&gt;After&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;network.target&lt;/span&gt;

&lt;span class="k"&gt;[Container]&lt;/span&gt;
&lt;span class="na"&gt;Image&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;lscr.io/linuxserver/plex:latest&lt;/span&gt;

&lt;span class="na"&gt;Network&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;host&lt;/span&gt;
&lt;span class="na"&gt;UserNS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;keep-id&lt;/span&gt;

&lt;span class="na"&gt;Environment&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;TZ=America/Chicago&lt;/span&gt;
&lt;span class="na"&gt;Environment&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;VERSION=docker&lt;/span&gt;
&lt;span class="na"&gt;Environment&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;PLEX_CLAIM=&amp;lt;REDACTED&amp;gt;&lt;/span&gt;

&lt;span class="na"&gt;Volume&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/home/server-user/plex/config:/config:Z&lt;/span&gt;
&lt;span class="na"&gt;Volume&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/media/wd-gold/Television:/tv:Z&lt;/span&gt;
&lt;span class="na"&gt;Volume&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/media/wd-gold/Movies:/movies:Z&lt;/span&gt;

&lt;span class="na"&gt;AddDevice&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/dev/dri:/dev/dri&lt;/span&gt;
&lt;span class="na"&gt;PublishPort&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;32400:32400/tcp&lt;/span&gt;

&lt;span class="k"&gt;[Service]&lt;/span&gt;
&lt;span class="na"&gt;Restart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;always&lt;/span&gt;

&lt;span class="k"&gt;[Install]&lt;/span&gt;
&lt;span class="na"&gt;WantedBy&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;default.target&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I don't think the &lt;code&gt;:Z&lt;/code&gt; is actually doing anything here because I don't think there are any SELinux labels in those paths, but it seems to be considered good practice and I can't imagine it hurts anything.&lt;/p&gt;
&lt;p&gt;This configuration does not exhibit the media deletion issue I experienced with Podman Compose.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# Remember to fix permissions if you&amp;#39;re coming from Docker&lt;/span&gt;
sudo&lt;span class="w"&gt; &lt;/span&gt;chown&lt;span class="w"&gt; &lt;/span&gt;-R&lt;span class="w"&gt; &lt;/span&gt;server-user:server-user&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/home/server-user/plex&amp;quot;&lt;/span&gt;

systemctl&lt;span class="w"&gt; &lt;/span&gt;--user&lt;span class="w"&gt; &lt;/span&gt;daemon-reload

systemctl&lt;span class="w"&gt; &lt;/span&gt;--user&lt;span class="w"&gt; &lt;/span&gt;start&lt;span class="w"&gt; &lt;/span&gt;plex.service
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here's the one for TiddlyWiki:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# /home/server-user/.config/containers/systemd/tiddlywiki.container &lt;/span&gt;
&lt;span class="k"&gt;[Unit]&lt;/span&gt;
&lt;span class="na"&gt;Description&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;TiddlyWiki&lt;/span&gt;
&lt;span class="na"&gt;After&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;network.target&lt;/span&gt;

&lt;span class="k"&gt;[Container]&lt;/span&gt;
&lt;span class="na"&gt;Image&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;docker.io/library/node:lts-alpine&lt;/span&gt;

&lt;span class="na"&gt;UserNS&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;keep-id&lt;/span&gt;

&lt;span class="na"&gt;Exec&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;npx --yes tiddlywiki /wiki --listen host=0.0.0.0 port=8080&lt;/span&gt;

&lt;span class="na"&gt;Volume&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;/home/server-user/wiki:/wiki:Z&lt;/span&gt;

&lt;span class="na"&gt;PublishPort&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;80:8080/tcp&lt;/span&gt;

&lt;span class="k"&gt;[Service]&lt;/span&gt;
&lt;span class="na"&gt;Restart&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;always&lt;/span&gt;

&lt;span class="k"&gt;[Install]&lt;/span&gt;
&lt;span class="na"&gt;WantedBy&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;default.target&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You may notice that I don't have a health check for this service like I had for Docker Compose. It doesn't seem like Quadlets have any equivalent functionality. I could certainly create a systemd service by hand to check the service's health, but I was never really reporting or reacting to the health check's status, so I ditched it instead.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# Remember to fix permissions if you&amp;#39;re coming from Docker&lt;/span&gt;
sudo&lt;span class="w"&gt; &lt;/span&gt;chown&lt;span class="w"&gt; &lt;/span&gt;-R&lt;span class="w"&gt; &lt;/span&gt;server-user:server-user&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;/home/server-user/wiki&amp;quot;&lt;/span&gt;

systemctl&lt;span class="w"&gt; &lt;/span&gt;--user&lt;span class="w"&gt; &lt;/span&gt;daemon-reload

systemctl&lt;span class="w"&gt; &lt;/span&gt;--user&lt;span class="w"&gt; &lt;/span&gt;start&lt;span class="w"&gt; &lt;/span&gt;tiddlywiki.service
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So far, this setup seems to be working. I plan on adding some more services and features in the future, like Traefik to route services to friendlier mDNS hostnames, and an IRC bouncer service. I'll be sure to write up more posts as I add those.&lt;/p&gt;
&lt;p&gt;While I was tinkering with these Quadlet files, sometimes I'd make a mistake. When a Quadlet file is invalid, the corresponding service is not generated. After running &lt;code&gt;daemon-reload&lt;/code&gt;, trying to start the service would give me a "unit not found" error. To see detailed errors explaining what was wrong with my Quadlet file, I'd run the following command:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;/usr/libexec/podman/quadlet&lt;span class="w"&gt; &lt;/span&gt;--dryrun&lt;span class="w"&gt; &lt;/span&gt;--user
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;These posts I write with the &lt;a href='https://jaysherby.com/blog/?q=home%20server'&gt;#home server&lt;/a&gt; tag are mostly just documentation for myself in the future. My previous posts have already come in handy when I make big changes to my system, like upgrading Debian. I highly recommend documenting your own projects for yourself.&lt;/p&gt;
</description>
      <author>hidden (jaysherby)</author>
      <guid isPermaLink="false">https://jaysherby.com/from-docker-compose-to-quadlets/</guid>
      <category>home server</category>
      <category>podman</category>
      <category>systemd</category>
      <pubDate>Sun, 26 Oct 2025 00:03:00 +0000</pubDate>
    </item>
    <item>
      <title>MacOS 26 "Tahoe" Applications Menu</title>
      <link>https://jaysherby.com/macos-26-tahoe-applications-menu/</link>
      <description>&lt;p&gt;Apple recently released the newest version of MacOS, "Tahoe", with their latest UI revolution: "liquid glass".&lt;/p&gt;
&lt;p&gt;&lt;img src="https://bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby/liquid-glass-is-great.webp" alt="" title="perfection" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;And it's going great! Everyone just loves it. /s&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;One of the less exciting changes is the replacement of the dedicated applications menu, activated from the "show apps" button on the dock, with the Spotlight search function in an applications-only filter mode. The UI is no longer fullscreen, but seeing as it is Spotlight, MacOS's dedicated search function, the search bar is front and center.&lt;/p&gt;
&lt;p&gt;And that's fine. I don't mind a keyboard-driven UI. There's just one problem...&lt;/p&gt;
&lt;p&gt;&lt;img src="https://bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby/spotlight-application-menu.gif" alt="" /&gt;&lt;/p&gt;
&lt;p&gt;As you can see in the above video, typing anything produces no results. After thinking about this for a bit, I decided to check the Spotlight settings, something I don't recall ever doing before. I'm not what you'd call a frequent Spotlight user.&lt;/p&gt;
&lt;p&gt;&lt;img src="https://bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby/spotlight-settings-apps.webp" alt="" title="Apps must be toggled on" /&gt;&lt;/p&gt;
&lt;p&gt;I've highlighted the option "apps" in the "results from system" section of Spotlight's options in the above screenshot. That setting was toggled off. It must be toggled on.&lt;/p&gt;
&lt;p&gt;I don't recall ever changing this option before. As I mentioned, I'm not a frequent Spotlight user. You would think Apple would make sure this was toggled on during the upgrade process to make sure their replacement for the old applications menu was guaranteed to work as expected. I'm not generally a fan of upgrades changing users' preferences, but now that Spotlight is the officially blessed way to launch applications, I can't think of a reason the user would want to prevent Spotlight from building that index. It would be appropriate to deprecate that option and always index installed applications' names.&lt;/p&gt;
</description>
      <author>hidden (jaysherby)</author>
      <guid isPermaLink="false">https://jaysherby.com/macos-26-tahoe-applications-menu/</guid>
      <category>MacOS</category>
      <pubDate>Mon, 29 Sep 2025 22:29:00 +0000</pubDate>
    </item>
    <item>
      <title>How To Add An Existing Git Repo To A Monorepo</title>
      <link>https://jaysherby.com/how-to-add-an-existing-git-repo-to-a-monorepo/</link>
      <description>&lt;p&gt;At several points over the course of my career, I've found myself lifting business logic code out of a monolithic application for the purposes of reuse across multiple applications.&lt;/p&gt;
&lt;p&gt;It's almost never appropriate to simply copy the current snapshot of the files in your main branch to a new directory and &lt;code&gt;git init&lt;/code&gt;. If you leave good commit messages, the repository's commit history can document the reasons why code was changed. You should keep that if you can.&lt;/p&gt;
&lt;p&gt;Depending on the intended consumers of your new business logic library, it may make sense for the new library to live in its own repository. This makes the code migration very easy. Fork the repo and start trimming away the application portions of the code. I've done this several times and the approach works well.&lt;/p&gt;
&lt;p&gt;I recently found myself in need of a more complex migration at $JOB. The code is going to be migrated into an existing monorepo. For the purposes of this example, a repository called &lt;code&gt;alpha&lt;/code&gt; is the existing application from which I'd like to harvest its business logic. A repository called &lt;code&gt;omega&lt;/code&gt; is the monorepo I'm targeting.&lt;/p&gt;
&lt;p&gt;Here's the process I followed to achieve this commit history transplant.&lt;/p&gt;
&lt;h2 id=step-1-add-the-codealphacode-remote-temporarily-to-codeomegacode&gt;Step 1: Add the &lt;code&gt;alpha&lt;/code&gt; remote temporarily to &lt;code&gt;omega&lt;/code&gt;&lt;/h2&gt;&lt;p&gt;Here's how my remote looks before I start:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;jaysherby@framework13:~/omega$&lt;span class="w"&gt; &lt;/span&gt;git&lt;span class="w"&gt; &lt;/span&gt;remote&lt;span class="w"&gt; &lt;/span&gt;-v
origin&lt;span class="w"&gt;  &lt;/span&gt;git@github.com:hexpunk/omega.git&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;fetch&lt;span class="o"&gt;)&lt;/span&gt;
origin&lt;span class="w"&gt;  &lt;/span&gt;git@github.com:hexpunk/omega.git&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;push&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Add &lt;code&gt;alpha&lt;/code&gt;'s remote. I'm calling it &lt;code&gt;temp&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;jaysherby@framework13:~/omega$&lt;span class="w"&gt; &lt;/span&gt;git&lt;span class="w"&gt; &lt;/span&gt;remote&lt;span class="w"&gt; &lt;/span&gt;add&lt;span class="w"&gt; &lt;/span&gt;temp&lt;span class="w"&gt; &lt;/span&gt;git@github.com:hexpunk/alpha.git
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Optionally confirm it worked.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;jaysherby@framework13:~/omega$&lt;span class="w"&gt; &lt;/span&gt;git&lt;span class="w"&gt; &lt;/span&gt;remote&lt;span class="w"&gt; &lt;/span&gt;-v
origin&lt;span class="w"&gt;  &lt;/span&gt;git@github.com:hexpunk/omega.git&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;fetch&lt;span class="o"&gt;)&lt;/span&gt;
origin&lt;span class="w"&gt;  &lt;/span&gt;git@github.com:hexpunk/omega.git&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;push&lt;span class="o"&gt;)&lt;/span&gt;
temp&lt;span class="w"&gt;    &lt;/span&gt;git@github.com:hexpunk/alpha.git&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;fetch&lt;span class="o"&gt;)&lt;/span&gt;
temp&lt;span class="w"&gt;    &lt;/span&gt;git@github.com:hexpunk/alpha.git&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;(&lt;/span&gt;push&lt;span class="o"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;And don't forget to fetch from the new remote before continuing so branches from the new remote can be referenced.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;jaysherby@framework13:~/omega$&lt;span class="w"&gt; &lt;/span&gt;git&lt;span class="w"&gt; &lt;/span&gt;fetch&lt;span class="w"&gt; &lt;/span&gt;temp
From&lt;span class="w"&gt; &lt;/span&gt;github.com:hexpunk/alpha
&lt;span class="w"&gt; &lt;/span&gt;*&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;new&lt;span class="w"&gt; &lt;/span&gt;branch&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;        &lt;/span&gt;main&lt;span class="w"&gt;                                                            &lt;/span&gt;-&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;temp/main
&lt;span class="w"&gt; &lt;/span&gt;*&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;[&lt;/span&gt;new&lt;span class="w"&gt; &lt;/span&gt;branch&lt;span class="o"&gt;]&lt;/span&gt;&lt;span class="w"&gt;        &lt;/span&gt;staging&lt;span class="w"&gt;                                                         &lt;/span&gt;-&amp;gt;&lt;span class="w"&gt; &lt;/span&gt;temp/staging
&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=step-2-make-a-new-branch-for-this&gt;Step 2: Make a new branch for this&lt;/h2&gt;&lt;p&gt;Nothing particularly unusual here. Make a new branch for this change and switch to it.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;jaysherby@framework13:~/omega$&lt;span class="w"&gt; &lt;/span&gt;git&lt;span class="w"&gt; &lt;/span&gt;switch&lt;span class="w"&gt; &lt;/span&gt;-c&lt;span class="w"&gt; &lt;/span&gt;import-alpha&lt;span class="w"&gt; &lt;/span&gt;main
Switched&lt;span class="w"&gt; &lt;/span&gt;to&lt;span class="w"&gt; &lt;/span&gt;a&lt;span class="w"&gt; &lt;/span&gt;new&lt;span class="w"&gt; &lt;/span&gt;branch&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;import-alpha&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=step-3-use-the-git-subtree-command-to-import-all-files-and-their-histories&gt;Step 3: Use the git subtree command to import all files and their histories&lt;/h2&gt;&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;jaysherby@framework13:~/omega$&lt;span class="w"&gt; &lt;/span&gt;git&lt;span class="w"&gt; &lt;/span&gt;subtree&lt;span class="w"&gt; &lt;/span&gt;add&lt;span class="w"&gt; &lt;/span&gt;--prefix&lt;span class="o"&gt;=&lt;/span&gt;applications/alpha/&lt;span class="w"&gt; &lt;/span&gt;temp/main
Added&lt;span class="w"&gt; &lt;/span&gt;dir&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;applications/alpha&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can see here that I've imported all of &lt;code&gt;alpha&lt;/code&gt;'s main branch (using the &lt;code&gt;temp&lt;/code&gt; remote name) to the path &lt;code&gt;applications/alpha&lt;/code&gt;. This brings all files' histories with it and adds a new commit with a commit message that looks like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;Add &amp;#39;applications/alpha/&amp;#39; from commit &amp;#39;123bf0fd7a82a76743adb0ce224a1987fe754093&amp;#39;

git-subtree-dir: applications/alpha
git-subtree-mainline: a2ac8af27a38f08d4774a4338c5c4a6ed0f24ff0
git-subtree-split: 123bf0fd7a82a76743adb0ce224a1987fe754093
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Those three lines at the end are called &lt;a href='https://git-scm.com/docs/git-interpret-trailers'&gt;trailers&lt;/a&gt; and they're a powerful and often overlooked feature of git commit messages.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;These&lt;/em&gt; trailers are an artifact of the &lt;code&gt;git subtree&lt;/code&gt; command, a contributed shell script that ships with git. It was written by Avery Pennarun, co-founder and CEO of Tailscale. Huh. It's worth a peruse of &lt;a href='https://manpage.me/?q=git-subtree'&gt;its man page&lt;/a&gt; because it's a powerful tool for situations like this one.&lt;/p&gt;
&lt;h2 id=step-4-remove-the-temporary-remote&gt;Step 4: Remove the temporary remote&lt;/h2&gt;&lt;p&gt;Now is as good a time as any to remember to remove that temporary remote I added since I won't need it anymore.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;jaysherby@framework13:~/omega$&lt;span class="w"&gt; &lt;/span&gt;git&lt;span class="w"&gt; &lt;/span&gt;remote&lt;span class="w"&gt; &lt;/span&gt;remove&lt;span class="w"&gt; &lt;/span&gt;temp
&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=step-5-push-your-branch-to-remote&gt;Step 5: Push your branch to remote&lt;/h2&gt;&lt;p&gt;Nothing unusual here, either. I'm just getting ready to make a pull request.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;jaysherby@framework13:~/omega$&lt;span class="w"&gt; &lt;/span&gt;git&lt;span class="w"&gt; &lt;/span&gt;push&lt;span class="w"&gt; &lt;/span&gt;-u&lt;span class="w"&gt; &lt;/span&gt;origin&lt;span class="w"&gt; &lt;/span&gt;import-alpha
&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=step-6-make-your-pull-request-emwithout-squashing-commitsem&gt;Step 6: Make your pull request &lt;em&gt;WITHOUT SQUASHING COMMITS!!!&lt;/em&gt;&lt;/h2&gt;&lt;p&gt;The only thing you must remember to do differently compared to most pull requests is this: &lt;strong&gt;&lt;em&gt;DO NOT SQUASH COMMITS ON MERGE&lt;/em&gt;&lt;/strong&gt;. I cannot overstate how important this is.
Depending on the repository, "squash commits" may be enabled by default for pull requests. Although this may be preferred for typical feature and bugfix merge flows, it would defeat the point of this entire exercise by squashing away all of that beautiful commit history I just worked so hard to maintain.&lt;/p&gt;
&lt;p&gt;&lt;img src="https://bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby/repo_settings.png" alt="" title="repository setting for squash commits by default" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby/merge_request.png" alt="" title="the squash commits option in the merge request (hi, gitlab!) is unchecked" /&gt;&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;git subtree&lt;/code&gt; command actually has a &lt;code&gt;--squash&lt;/code&gt; option that I specifically chose not to use. Squashing commits from subtree commands makes sense if I was going to use this as an alternative to &lt;code&gt;git submodule&lt;/code&gt;, which is the situation most prominently described in the documentation. In my case, having the files' histories ride along with them as they're assimilated into the monorepo is precisely the value of this operation.&lt;/p&gt;
&lt;h2 id=step-7-diligently-isolate-the-renaming-of-files-within-their-own-commits&gt;Step 7: Diligently isolate the renaming of files within their own commits&lt;/h2&gt;&lt;p&gt;Wouldn't it be terrible if I did all of this work to keep files' histories just to throw it all away? That's why I need to be really strict with myself as I move and rename files and directories. Git is really good at recognizing file movement as long as it happens in isolated commits. If I were to move the file &lt;em&gt;and&lt;/em&gt; change its contents, I risk the history looking like a delete and a create instead of a rename, which will essentially launder the history of the file for common file-wise history tools like &lt;code&gt;git blame&lt;/code&gt;.&lt;/p&gt;
</description>
      <author>hidden (jaysherby)</author>
      <guid isPermaLink="false">https://jaysherby.com/how-to-add-an-existing-git-repo-to-a-monorepo/</guid>
      <category>git</category>
      <pubDate>Sat, 05 Jul 2025 20:38:00 +0000</pubDate>
    </item>
    <item>
      <title>Fixing "Open in Terminal" in Pop!_OS</title>
      <link>https://jaysherby.com/fixing-open-in-terminal-in-pop_os/</link>
      <description>&lt;p&gt;Pop!_OS has this feature in its file manager, Nautilus, that allows you to open a terminal in the current directory using the context menu's "Open in Terminal" option. This is provided by a package called &lt;code&gt;nautilus-extension-gnome-terminal&lt;/code&gt;. It opens a new &lt;code&gt;gnome-terminal&lt;/code&gt; using the &lt;code&gt;--working-directory&lt;/code&gt; command line option set to the directory currently open in Nautilus.&lt;/p&gt;
&lt;p&gt;&lt;img src="https://bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby/nautilus-open-in-terminal.png" alt="nautilus-open-in-terminal" /&gt;&lt;/p&gt;
&lt;p&gt;I don't know when this stopped working properly, but I noticed the issue this evening. It will open a terminal window, but the resulting shell session no longer seems to open in the requested directory.&lt;/p&gt;
&lt;p&gt;I futzed with it quite a bit. It will work properly if I run &lt;code&gt;gnome-terminal --working-directory=&amp;quot;$PWD&amp;quot; -- bash --norc&lt;/code&gt;, which led me to believe that it had something to do with my &lt;code&gt;.bashrc&lt;/code&gt; file. It turns out it has nothing to do with my &lt;code&gt;.bashrc&lt;/code&gt; file because removing my &lt;code&gt;.bashrc&lt;/code&gt; file entirely does not fix it.&lt;/p&gt;
&lt;p&gt;My fix (or at least workaround) was to change my gnome-terminal profile setting "Preserve working directory" from "Shell only" to "Always". That seems to do the trick.&lt;/p&gt;
&lt;p&gt;&lt;img src="https://bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby/gnome-terminal-preferences.png" alt="gnome-terminal-preferences" /&gt;&lt;/p&gt;
&lt;p&gt;This feels really familiar like I've had to deal with it before, but I never blogged about it. It doesn't look like anything has recently changed that would have caused this to suddenly happen. This feature was added to &lt;code&gt;gnome-terminal&lt;/code&gt; &lt;a href='https://gitlab.gnome.org/GNOME/gnome-terminal/-/issues/126'&gt;more than 4 years ago&lt;/a&gt;. All relevant packages (&lt;code&gt;gnome-terminal&lt;/code&gt;, &lt;code&gt;nautilus&lt;/code&gt;, &lt;code&gt;nautilus-extension-gnome-terminal&lt;/code&gt;) haven't been updated in more than 6 months. Maybe I just noticed it for the first time on this machine tonight, but it's been like that the whole time. ðŸ¤·&lt;/p&gt;
</description>
      <author>hidden (jaysherby)</author>
      <guid isPermaLink="false">https://jaysherby.com/fixing-open-in-terminal-in-pop_os/</guid>
      <category>gnome-terminal</category>
      <category>nautilus</category>
      <category>pop_os</category>
      <pubDate>Fri, 20 Jun 2025 04:08:00 +0000</pubDate>
    </item>
    <item>
      <title>Adopt These Trackers</title>
      <link>https://jaysherby.com/adopt-these-trackers/</link>
      <description>&lt;p&gt;A recent blog post by Kian Bradley called &lt;a href='https://kianbradley.com/2025/06/15/resurrecting-a-dead-tracker.html'&gt;"Resurrecting a dead torrent tracker and finding 3 million peers"&lt;/a&gt; is making the rounds and it captured my imagination. There's something undeniably punk rock about adopting a dead tracker and bringing it back to life.&lt;/p&gt;
&lt;p&gt;I was curious how someone might find old tracker domains to resurrect, though. Kian seemed to find his through natural usage of BitTorrent. I had a different idea.&lt;/p&gt;
&lt;p&gt;&lt;a href='https://github.com/ngosang/trackerslist'&gt;This git repository&lt;/a&gt; has an automatically updated list of valid tracker URLs as well as an automatically updated block list. It also has 50k stars on GitHub, so I figure it's a decent source of data.&lt;/p&gt;
&lt;p&gt;I vibe-coded up a &lt;a href='https://www.nushell.sh/'&gt;Nushell&lt;/a&gt; script that will look through the git history for tracker domain names that were removed from the tracker list but never added to the block list. Finally, it writes out the results in files of max 100 entries because the final step is embarrassingly manual. I checked the removed but not blocked domains in the bulk search feature of my preferred registrar, who limits bulk search to 100 entries at a time.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;#!/bin/env nu

def parse_file [path: string] {
  open $path
  | str replace &amp;#39;\n\n+&amp;#39; &amp;#39;\n&amp;#39;
  | lines
  | str trim
  | where {|x| $x != &amp;quot;&amp;quot;}
  | uniq
}

def get_all_commits [] {
  ^git rev-list master
  | lines
}

def build_blacklist_set [] {
  get_all_commits
  | each {|rev|
      let file = (try { ^git show $&amp;quot;($rev):blacklist.txt&amp;quot; } catch { &amp;quot;&amp;quot; })
      $file
      | lines
      | str trim
      | where {|x| $x != &amp;quot;&amp;quot;}
  }
  | flatten
  | uniq
}

def main [] {
  let all_commits = (get_all_commits | reverse)
  let blacklist_set = (build_blacklist_set)

  mut prev_trackers = []
  mut removed_total = []

  for commit in $all_commits {
    let file = (try { ^git show $&amp;quot;($commit):trackers_all.txt&amp;quot; } catch { &amp;quot;&amp;quot; })
    let trackers = (
      $file
      | str replace &amp;#39;\n\n+&amp;#39; &amp;#39;\n&amp;#39;
      | lines
      | str trim
      | where {|x| $x != &amp;quot;&amp;quot;}
      | uniq
    )

    if ($prev_trackers | length) &amp;gt; 0 {
      let removed = ($prev_trackers | where {|x| not ($trackers | any {|y| $y == $x }) })
      $removed_total = ($removed_total | append $removed)
    }

    $prev_trackers = $trackers
  }

  let final_list = (
    $removed_total
    | flatten
    | uniq
    | where {|x| not ($blacklist_set | any {|y| $y == $x }) }
    | parse -r &amp;#39;(?P&amp;lt;uri&amp;gt;.+)&amp;#39;  # ensure strings not treated as plain
    | each {|row|
        let host = (try { $row.uri | url parse | get host } catch { &amp;quot;&amp;quot; })
        let parts = ($host | split row &amp;quot;.&amp;quot;)
        if ($parts | length) &amp;gt;= 2 {
          let root = ($parts | last 2 | str join &amp;quot;.&amp;quot;)
          $root
        } else {
          $host  # fallback to full host if malformed
        }
    }
    | uniq
  )

  # Save output in batches of 100
  let chunked = ($final_list | chunks 100)

  let saved_files = $chunked
  | enumerate
  | each {|row|
      let idx = $row.index
      let part = $row.item
      let filename = $&amp;quot;output_part_($idx | fill -c &amp;#39;0&amp;#39; -w 3).txt&amp;quot;
      $part | str join &amp;quot;\n&amp;quot; | save --force $filename
      $filename
  }

  $saved_files
}
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;After a little copy-pasta, here are the available domain names that were once trackers:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;edoardocolombo.eu&lt;/li&gt;
&lt;li&gt;poweredcore.com&lt;/li&gt;
&lt;li&gt;demonoid.ooo&lt;/li&gt;
&lt;li&gt;bluefrog.pw&lt;/li&gt;
&lt;li&gt;bittor.xyz&lt;/li&gt;
&lt;li&gt;grifon.info&lt;/li&gt;
&lt;li&gt;facedatabg.net&lt;/li&gt;
&lt;li&gt;dl1234.com&lt;/li&gt;
&lt;li&gt;torrentsnows.com&lt;/li&gt;
&lt;li&gt;torrentclub.tech&lt;/li&gt;
&lt;li&gt;nullrebel.com&lt;/li&gt;
&lt;li&gt;value-wolf.org&lt;/li&gt;
&lt;li&gt;handrew.me&lt;/li&gt;
&lt;li&gt;derpyradio.net&lt;/li&gt;
&lt;li&gt;100.pet&lt;/li&gt;
&lt;li&gt;sleepyinternetfun.xyz&lt;/li&gt;
&lt;li&gt;nrx.me&lt;/li&gt;
&lt;li&gt;highstar.shop&lt;/li&gt;
&lt;li&gt;oldboystudy.com&lt;/li&gt;
&lt;li&gt;chennuo.xyz&lt;/li&gt;
&lt;li&gt;120181311.xyz&lt;/li&gt;
&lt;li&gt;chouchou.top&lt;/li&gt;
&lt;li&gt;buddyfly.top&lt;/li&gt;
&lt;li&gt;torrentclub.space&lt;/li&gt;
&lt;li&gt;arcbox.cc&lt;/li&gt;
&lt;li&gt;trojangogogo.site&lt;/li&gt;
&lt;li&gt;sheesh.rip&lt;/li&gt;
&lt;li&gt;market-re.quest&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This was a quick little project that took me all of 20 minutes to satisfy my curiosity. If I cared more deeply about answering this question, I might be inclined to try to scrape torrent search websites to collect tracker URLs from their &lt;a href='https://en.wikipedia.org/wiki/Magnet_URI_scheme'&gt;magnet links&lt;/a&gt; instead of relying on one GitHub repository. I'd also want to figure out a way to automate checking if domains are available for sale. That data appears to be gated behind services that require registration and might cost money.&lt;/p&gt;
</description>
      <author>hidden (jaysherby)</author>
      <guid isPermaLink="false">https://jaysherby.com/adopt-these-trackers/</guid>
      <category>bittorrent</category>
      <category>nushell</category>
      <pubDate>Wed, 18 Jun 2025 03:38:00 +0000</pubDate>
    </item>
    <item>
      <title>Don't Rely On mtime For Anything Important</title>
      <link>https://jaysherby.com/dont-rely-on-mtime-for-anything-important/</link>
      <description>&lt;p&gt;Rachel Kroll posted &lt;a href='https://rachelbythebay.com/w/2025/05/31/sync/'&gt;"rsync's defaults are not always enough"&lt;/a&gt; on her well-known blog yesterday. Everything she said is true. It's a short post, just over 500 words. Go read it.&lt;/p&gt;
&lt;p&gt;The gist is that venerable data transfer application &lt;code&gt;rsync&lt;/code&gt; by default only compares the file size and modification time (mtime) to decide if a file has differed between the source and destination. There is an option to compare files by checksum instead. In the &lt;code&gt;rsync&lt;/code&gt; man page, it shows the option &lt;code&gt;--checksum, -c&lt;/code&gt;: "skip based on checksum, not mod-time &amp; size".&lt;/p&gt;
&lt;p&gt;In Rachel's case, a particular file's contents had changed, but the overall file size hadn't changed, &lt;em&gt;and the mtime hadn't changed&lt;/em&gt;. The first part makes sense. If you swap one byte in a file with another byte, the file's contents have changed but its overall size has not. But how would the mtime stay the same? Probably shenanigans from a human being somewhere. But let's stop a moment and answer the question...&lt;/p&gt;
&lt;h2 id=what-is-mtime&gt;What is mtime?&lt;/h2&gt;&lt;p&gt;Depending on the features of the file system being used, there may be lots of metadata attached to a file. Speaking broadly, most file systems used with *nix operating systems include things like the owning user's id, the owning group's id, read/write/execute permissions, atime, and mtime.&lt;/p&gt;
&lt;p&gt;Atime stands for access time. Whenever a file is read, the atime is updated. This is theoretically great for audit logging, except that it doesn't tell you &lt;em&gt;who&lt;/em&gt; accessed the file, and it creates a lot of disk activity overhead. Imagine having to write to disk every time you read from disk. That's why this option is usually disabled by default in most modern systems I've used.&lt;/p&gt;
&lt;p&gt;The very fact that a configuration option can disable one of these should automatically give you trust issues.&lt;/p&gt;
&lt;p&gt;Mtime, as previously established, stands for modification time. But what does that really mean? I'm running Pop!_OS and the oldest file on my system is &lt;code&gt;/usr/share/doc/cron/THANKS&lt;/code&gt; from September 1st, 1994. But I bought this laptop earlier this year! I doubt there's a single part inside that was manufactured before 2023. SSDs didn't even exist in 1994. How could this file's mtime be from the mid-1990s?&lt;/p&gt;
&lt;p&gt;Here's our first problem. Is mtime supposed to represent the last time the file was modified &lt;em&gt;anywhere&lt;/em&gt; or when it was modified on this particular storage device? I guess that's up for interpretation. When you transfer files using &lt;code&gt;rsync&lt;/code&gt;'s archive mode (&lt;code&gt;--archive, -a&lt;/code&gt;), it copies metadata from the source to the destination exactly, including the mtime. This is also true when files are untarballed. So, depending on how a file arrived onto your hard disk, its mtime may predate your device.&lt;/p&gt;
&lt;p&gt;Our second problem is the &lt;code&gt;touch&lt;/code&gt; command.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;NAME
     touch - change file access and modification times
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This command, available to every user to use on any file they can write to, is explicitly for modifying atime and mtime. Here's a bit of an ontological question. If I can update the modification time of a file without actually modifying the contents of the file, does mtime still have any real meaning?&lt;/p&gt;
&lt;p&gt;The most common usage of &lt;code&gt;touch&lt;/code&gt; is with default settings, &lt;code&gt;touch filename&lt;/code&gt;, which simply updates mtime to the current date and time. However, it's not like it's hard to change mtime to whatever value you want.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;jaysherby@framework13:~$&lt;span class="w"&gt; &lt;/span&gt;touch&lt;span class="w"&gt; &lt;/span&gt;filename
jaysherby@framework13:~$&lt;span class="w"&gt; &lt;/span&gt;ls&lt;span class="w"&gt; &lt;/span&gt;-lah&lt;span class="w"&gt; &lt;/span&gt;filename
-rw-rw-r--&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;jaysherby&lt;span class="w"&gt; &lt;/span&gt;jaysherby&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;Jun&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;15&lt;/span&gt;:54&lt;span class="w"&gt; &lt;/span&gt;filename
jaysherby@framework13:~$&lt;span class="w"&gt; &lt;/span&gt;touch&lt;span class="w"&gt; &lt;/span&gt;--date&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;1970-01-01 16:20:00 UTC&amp;quot;&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;filename
jaysherby@framework13:~$&lt;span class="w"&gt; &lt;/span&gt;ls&lt;span class="w"&gt; &lt;/span&gt;-lah&lt;span class="w"&gt; &lt;/span&gt;filename
-rw-rw-r--&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;jaysherby&lt;span class="w"&gt; &lt;/span&gt;jaysherby&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="m"&gt;0&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;Jan&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;1&lt;/span&gt;&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="m"&gt;1970&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;filename
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It's just that easy to forge a file's mtime. I suspect that's what happened to Rachel's system file. Why would someone change a file's contents making sure not to change its length and then modify its mtime to match the file before the change occurred? It seems very suspicious if not necessarily malicious.&lt;/p&gt;
&lt;p&gt;Mtime is so notoriously unreliable that &lt;code&gt;git&lt;/code&gt;, for example, keeps its own internal file modification timestamp records and notably does not update mtime values to match its internal records. I found this out once upon a time when I was curious about the oldest files in a repository and found that I had to parse git logs to do so.&lt;/p&gt;
&lt;h2 id=what-checksum-does-codersynccode-use&gt;What checksum does &lt;code&gt;rsync&lt;/code&gt; use?&lt;/h2&gt;&lt;p&gt;I was curious about this. It seems that when you pass one of the &lt;code&gt;--checksum, -c&lt;/code&gt; flags, &lt;code&gt;rsync&lt;/code&gt; defaults to using MD5, which is probably fine. But if you don't like it and would prefer something else, there's also the &lt;code&gt;--checksum-choice=STR&lt;/code&gt; flag: "choose the checksum algorithm (aka --cc)". You can run &lt;code&gt;rsync --version&lt;/code&gt; locally to see what algorithms your version of &lt;code&gt;rsync&lt;/code&gt; supports. My local copy supports some xxhash algorithms, MD5, MD4, and SHA1.&lt;/p&gt;
&lt;h2 id=will-this-prevent-corruptions-during-transfer-like-bittorrent&gt;Will this prevent corruptions during transfer, like BitTorrent?&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;No.&lt;/strong&gt; The checksum is only run on files &lt;em&gt;before&lt;/em&gt; transfer to determine if the destination file needs to be updated. It does not compare checksums after transfer has completed.&lt;/p&gt;
&lt;p&gt;This is important for my use cases. I'm usually using &lt;code&gt;rsync&lt;/code&gt; to move files from one place to another, not to back them up. That means I will delete the source files after the transfer is complete. I have been bitten by this before when files end up mysteriously corrupted. That's why I know so much about this aspect of the &lt;code&gt;rsync&lt;/code&gt; tool.&lt;/p&gt;
&lt;p&gt;Think about the complete path a file needs to traverse when it's transferred via &lt;code&gt;rsync&lt;/code&gt;.  To goes from the disk, to memory, through application code, over the network, through application code, to memory, to disk. There are several places in that pipeline where something could technically go wrong and I'd never know.&lt;/p&gt;
&lt;p&gt;You can create your own utility or script to hash the files on both sides afterwards and compare them, or you can just run the &lt;code&gt;rsync&lt;/code&gt; command again. I do the latter due to simplicity. If everything transferred fine the first time, nothing should need to be transferred on the second run. After that, I feel safe deleting the local copy of the files.&lt;/p&gt;
&lt;p&gt;I don't think &lt;code&gt;rsync&lt;/code&gt; or network issues were at fault for the occasional file corruptions I've experienced, but it's nice to be able to reasonably rule it out.&lt;/p&gt;
&lt;p&gt;Don't use mtime for anything important. Its meaning is debatable, and it's a convenient fiction at best.&lt;/p&gt;
</description>
      <author>hidden (jaysherby)</author>
      <guid isPermaLink="false">https://jaysherby.com/dont-rely-on-mtime-for-anything-important/</guid>
      <category>rsync</category>
      <pubDate>Sun, 01 Jun 2025 21:12:00 +0000</pubDate>
    </item>
    <item>
      <title>VSCode Debugger: Ignoring Exceptions In Your Dependencies</title>
      <link>https://jaysherby.com/vscode-debugger-ignoring-exceptions-in-your-dependencies/</link>
      <description>&lt;p&gt;I spend a lot of my time at work debugging a web application server that runs on top of Node. Like most web application servers, it has robust exception handling to make sure that uncaught exceptions don't crash the server application.&lt;/p&gt;
&lt;p&gt;While this is a solid engineering decision, it does make debugging the application a little more complicated. Sometimes exceptions are thrown that don't have stack traces or even descriptive names. That's the worst case scenario. I know an exception occurred, but I don't know what or where.&lt;/p&gt;
&lt;p&gt;When debugging this in the VSCode debugger, you're given two options:&lt;/p&gt;
&lt;p&gt;&lt;img src="https://bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby/uncaught-exceptions.png" alt="" /&gt;&lt;/p&gt;
&lt;p&gt;Checking "uncaught exceptions" isn't going to help here because &lt;em&gt;all&lt;/em&gt; exceptions are caught, even if it's only at the point of the web application server's umbrella exception handler.&lt;/p&gt;
&lt;p&gt;Checking "caught exceptions" will stop on every caught exception, which will eventually catch the exception you're looking for. However, it will also stop on all of the other exceptions that are thrown. I've noticed that my dependencies often throw a lot of exceptions that they catch. Hey, throwing and catching is just another method of control flow. Who am I to say my dependencies can't use it? But it does create a lot more noise when I'm trying to debug a problem in my own code.&lt;/p&gt;
&lt;p&gt;Here's a debugger launch configuration that runs &lt;code&gt;npm run start:server&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="c1"&gt;// Use IntelliSense to learn about possible attributes.&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="c1"&gt;// Hover to view descriptions of existing attributes.&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="c1"&gt;// For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;version&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;0.2.0&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;configurations&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;type&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;node&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;request&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;launch&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Start Server&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;runtimeExecutable&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;npm&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;runtimeArgs&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;run&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;start:server&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;console&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;integratedTerminal&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;skipFiles&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;lt;node_internals&amp;gt;/**&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;**/node_modules/**&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt;
&lt;span class="w"&gt;            &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;internalConsoleOptions&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;neverOpen&amp;quot;&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The crucial addition here is in the &lt;code&gt;skipFiles&lt;/code&gt; array. The &lt;code&gt;&amp;quot;&amp;lt;node_internals&amp;gt;/**&amp;quot;&lt;/code&gt; element is there by default in VSCode. I've added the &lt;code&gt;&amp;quot;**/node_modules/**&amp;quot;&lt;/code&gt; element for the same reason the default entry is present. I'm only interested in where the exceptions are introduced inside &lt;em&gt;my&lt;/em&gt; code. If an exception is thrown and caught within Node's implementation or within my dependencies, I don't care about it. I only care about exceptions that were caused by my code, that my code needs to handle.&lt;/p&gt;
&lt;p&gt;This launch configuration works fine, but I don't typically run my local web application server from launch configurations. In my workflow, I tend to launch it from the NPM scripts pane in the explorer view. When launched in debug mode, it runs the appropriate command inside of a JavaScript Debug Terminal.&lt;/p&gt;
&lt;p&gt;Quick aside, I love the JavaScript Debug Terminal feature in VSCode. I can run Node or NPM in a terminal session and VSCode's debugger automatically attaches.&lt;/p&gt;
&lt;p&gt;In any case, I want this configuration for the JavaScript Debug Terminal, too! The way to do this is to add a new key in my &lt;code&gt;settings.json&lt;/code&gt; file.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;debug.javascript.terminalOptions&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="nt"&gt;&amp;quot;skipFiles&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&amp;lt;node_internals&amp;gt;/**&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;**/node_modules/**&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;With this addition, I now get to ignore noisy exceptions inside my dependencies. And if an exception is thrown in a dependency and my code is expected to handle it, the debugger stops at the line in my code where the exception was thrown instead of in the deepest bowels of the dependency's probably minified code.&lt;/p&gt;
</description>
      <author>hidden (jaysherby)</author>
      <guid isPermaLink="false">https://jaysherby.com/vscode-debugger-ignoring-exceptions-in-your-dependencies/</guid>
      <category>nodejs</category>
      <pubDate>Fri, 30 May 2025 22:27:00 +0000</pubDate>
    </item>
    <item>
      <title>Batching Messages in Async Clojure</title>
      <link>https://jaysherby.com/batching-messages-in-async-clojure/</link>
      <description>&lt;p&gt;I read this interesting blog post called &lt;a href='https://matklad.github.io/2025/05/14/scalar-select-aniti-pattern.html'&gt;Scalar Select Anti-Pattern&lt;/a&gt; by Alex Kladov about the advantages to batching the processing of messages when you're working with an event-driven asynchronous loop pattern. I recommend you go and read it.&lt;/p&gt;
&lt;p&gt;It came at just the right time, too, because I was recently working with just such a pattern in Clojure using its &lt;a href='https://github.com/clojure/core.async'&gt;async library&lt;/a&gt;. Here's the basic outline of what I had before I read the aforementioned blog post.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;require&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;clojure.core.async&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ss"&gt;:refer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;&amp;lt;!&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;chan&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;go-loop&lt;/span&gt;&lt;span class="p"&gt;]])&lt;/span&gt;

&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;defonce &lt;/span&gt;&lt;span class="nv"&gt;running?&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;atom&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;true&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;defonce &lt;/span&gt;&lt;span class="nv"&gt;ch&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;chan&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;go-loop&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[]&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;when &lt;/span&gt;&lt;span class="o"&gt;@&lt;/span&gt;&lt;span class="nv"&gt;running?&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;when-let &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;message&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;&amp;lt;!&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ch&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="c1"&gt;;; Process a message&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="c1"&gt;;; When I want to quit:&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="c1"&gt;;; (reset! running? false)&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;recur&lt;/span&gt;&lt;span class="p"&gt;))))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;My &lt;code&gt;go-loop&lt;/code&gt; block is a state machine that waits for a val from the channel &lt;code&gt;ch&lt;/code&gt; and then processes it. It does this loop until the &lt;code&gt;running?&lt;/code&gt; atom is set to &lt;code&gt;false&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;In order to process messages in batches, I need a function that will drain a channel of vals and return a vector of them.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;require&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="o"&gt;&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;clojure.core.async&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="ss"&gt;:refer&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;poll!&lt;/span&gt;&lt;span class="p"&gt;]])&lt;/span&gt;

&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;defn &lt;/span&gt;&lt;span class="nv"&gt;collect-available!&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;ch&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;loop &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;acc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[]]&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;if-some&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;msg&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;poll!&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ch&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;recur&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;conj &lt;/span&gt;&lt;span class="nv"&gt;acc&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;msg&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nv"&gt;acc&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Okay, I'm half-way there. Now I want to encapsulate this idea to include awaiting the first value within a &lt;code&gt;go-loop&lt;/code&gt; before draining the rest of the channel.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="kd"&gt;defn &lt;/span&gt;&lt;span class="nv"&gt;collect-batch!&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;ch&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;go&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;if-some&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;first-msg&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;&amp;lt;!&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ch&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;let &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;rest-msgs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;collect-available!&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ch&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;conj &lt;/span&gt;&lt;span class="nv"&gt;rest-msgs&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;first-msg&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="nv"&gt;nil&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Cool! Now I can process messages in batches with a little tweak to my &lt;code&gt;go-loop&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;go-loop&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[]&lt;/span&gt;
&lt;span class="w"&gt;  &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;when &lt;/span&gt;&lt;span class="o"&gt;@&lt;/span&gt;&lt;span class="nv"&gt;running?&lt;/span&gt;
&lt;span class="w"&gt;    &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;if-some&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;messages&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;&amp;lt;!&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;collect-batch!&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;ch&lt;/span&gt;&lt;span class="p"&gt;))]&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;do&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;doseq &lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;message&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;messages&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="w"&gt;          &lt;/span&gt;&lt;span class="c1"&gt;;; Process a message&lt;/span&gt;
&lt;span class="w"&gt;          &lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="w"&gt;        &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;recur&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;span class="w"&gt;      &lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nf"&gt;reset!&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;running?&lt;/span&gt;&lt;span class="w"&gt; &lt;/span&gt;&lt;span class="nv"&gt;false&lt;/span&gt;&lt;span class="p"&gt;))))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I've added some safety so that my &lt;code&gt;go-loop&lt;/code&gt; exits if the channel &lt;code&gt;ch&lt;/code&gt; is closed.&lt;/p&gt;
&lt;p&gt;This is already an improvement since I only have to yield to the scheduler once per &lt;em&gt;batch&lt;/em&gt; of messages rather than once per individual message. It also establishes the pattern, which will make it easier to utilize other optimization strategies like the ones Alex discusses in his blog post when I find I need them.&lt;/p&gt;
</description>
      <author>hidden (jaysherby)</author>
      <guid isPermaLink="false">https://jaysherby.com/batching-messages-in-async-clojure/</guid>
      <pubDate>Tue, 20 May 2025 01:38:00 +0000</pubDate>
    </item>
    <item>
      <title>Maybe Fix Your Philips Sonicare Toothbrush</title>
      <link>https://jaysherby.com/maybe-fix-your-philips-sonicare-toothbrush/</link>
      <description>&lt;p&gt;&lt;img src="https://bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby/toothbrush-all-parts.webp" alt="toothbrush-all-parts" /&gt;&lt;/p&gt;
&lt;p&gt;I like my Philips Sonicare electric toothbrush, but I've had two of them fail in exactly the same way. I decided to open it up and figure out why. Unfortunately, I destroyed mine in the process, but only for lack of information. Maybe you can fix yours armed with what I learned.&lt;/p&gt;
&lt;p&gt;Standard disclaimer: I'm not responsible for how you use this information. If you break a working toothbrush or hurt yourself, don't blame me. If you're not comfortable opening up electronic devices that weren't meant to be customer serviceable, don't try to repair your toothbrush. I strongly recommend reading this to the end before attempting any of the steps I'm about to describe.&lt;/p&gt;
&lt;h2 id=the-symptoms&gt;The symptoms&lt;/h2&gt;&lt;p&gt;Both of my toothbrushes that failed in this way stopped vibrating the brush head with any significant force, but they became unsettlingly loud while they were turned on. If I took the brush head off, the metal prong the brush head is press fit onto seemed looser than when it was new. It would freely tilt forward and back.&lt;/p&gt;
&lt;h2 id=opening-up-the-toothbrush&gt;Opening up the toothbrush&lt;/h2&gt;&lt;p&gt;To open the toothbrush, you must use a spudger to pry out the cap on the bottom of the enclosure. It is press fit into place and has a rubber o-ring to keep water out. I recommend using a plastic spudger as the metal one I used chewed up the plastic on the enclosure.&lt;/p&gt;
&lt;p&gt;&lt;img src="https://bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby/toothbrush-cap-front.webp" alt="toothbrush-cap-front" /&gt;
&lt;img src="https://bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby/toothbrush-cap-side.webp" alt="toothbrush-cap-side" /&gt;
&lt;img src="https://bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby/toothbrush-cap-back.webp" alt="toothbrush-cap-back" /&gt;&lt;/p&gt;
&lt;p&gt;Once the cap is removed, there are two clips holding the inner assembly inside the enclosure. This is what tripped me up and led to the damage to the induction coil at the bottom that is used to charge the battery, as seen in the photo. Using thin spudgers, small screwdrivers, or perhaps even a bent paperclip, I believe the clips can be undone without causing damage. The inner assembly should freely and easily slide out of the enclosure. It's probably a fiddly job, but I'm pretty sure it's possible to do.&lt;/p&gt;
&lt;p&gt;&lt;img src="https://bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby/toothbrush-tabs.webp" alt="toothbrush-tabs" /&gt;&lt;/p&gt;
&lt;h2 id=the-underlying-issue&gt;The underlying issue&lt;/h2&gt;&lt;p&gt;See the screw at the top of the toothbrush, near the mechanism attached to the brush head's prong? Check to see if it's loose and tighten it if it is.&lt;/p&gt;
&lt;p&gt;&lt;img src="https://bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby/toothbrush-front.webp" alt="toothbrush-front" /&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;That's it.&lt;/em&gt; That screw came loose and your toothbrush failed. It probably came loose because it's part of a mechanism that's subject to intense vibration when the toothbrush is in use. A fraction of a cent's worth of thread locking compound would probably prevent this failure and keep these toothbrushes in service for much longer.&lt;/p&gt;
&lt;p&gt;If you look at the back of the assembly, you'll see two pieces of metal, pictured here. They rest against each other thanks to the pressure provided when the aforementioned screw is tight, but they are otherwise unsecured to one another.&lt;/p&gt;
&lt;p&gt;&lt;img src="https://bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby/toothbrush-back.webp" alt="toothbrush-back" /&gt;&lt;/p&gt;
&lt;p&gt;The bottom piece is the actuator that vibrates when the toothbrush is on. The top pieces are part of the sub-assembly that connects to the brush prong. If that screw becomes loose, there's not enough resistance to keep the prong assembly in contact with the actuator, causing it to vibrate freely instead of channeling the vibration into your brush head.&lt;/p&gt;
&lt;h2 id=closing-up&gt;Closing up&lt;/h2&gt;&lt;p&gt;I broke my toothbrush and won't be reassembling it, but it should be as easy as taking it apart in reverse. Make sure the inner assembly's black plastic rails locate in the grooves along the inside of the enclosure. Insert it until the clips snap into place. Firmly press the bottom cap back into place.&lt;/p&gt;
&lt;p&gt;&lt;img src="https://bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby/toothbrush-enclosure-inside.webp" alt="toothbrush-enclosure-inside" /&gt;&lt;/p&gt;
&lt;p&gt;Note that the lithium ion battery in the assembly looks like it's replaceable. &lt;strong&gt;The battery is not replaceable.&lt;/strong&gt;  Do not try to remove it as it is soldered to the circuit board, but not so strongly that it won't easily break off if you force it.&lt;/p&gt;
&lt;p&gt;In case it helps someone searching for the numbers on the bottom of their toothbrush, here are the numbers that were on the bottom of this one:&lt;/p&gt;
&lt;p&gt;HX681J&lt;/p&gt;
&lt;p&gt;210706 1A&lt;/p&gt;
&lt;p&gt;FCC ID: 2ADZNHX86&lt;/p&gt;
&lt;p&gt;IC: 20109-HX68&lt;/p&gt;
</description>
      <author>hidden (jaysherby)</author>
      <guid isPermaLink="false">https://jaysherby.com/maybe-fix-your-philips-sonicare-toothbrush/</guid>
      <category>right to repair</category>
      <pubDate>Mon, 14 Apr 2025 22:03:00 +0000</pubDate>
    </item>
  </channel>
</rss>
