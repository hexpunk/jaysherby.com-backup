<!DOCTYPE html>
<html lang="en">

<head>
  
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5">
  
  <title>Randomizing My MAC Address With NetworkManager | Jay&#x27;s blog</title>
  <link rel="canonical" href="index.html">
  
    

    <meta name="jaysherby" content="look-for-the-bear-necessities">

    <!-- Primary Meta Tags -->
<meta name="title" content="Randomizing My MAC Address With NetworkManager">
<meta name="description" content="My life is harder for knowing and caring about my own privacy and security.  For example, if you&#x27;ve ever connected to the wifi at a Starbucks using a laptop,...">

<!-- Open Graph / Facebook -->
<meta property="og:site_name" content="Jay&#x27;s blog">
<meta property="og:title" content="Randomizing My MAC Address With NetworkManager">
<meta property="og:type" content="article">
<meta property="og:url" content="https://jaysherby.com/randomizing-mac-addresses-with-networkmanager/">
<meta property="og:description" content="My life is harder for knowing and caring about my own privacy and security.  For example, if you&#x27;ve ever connected to the wifi at a Starbucks using a laptop,...">
<meta property="og:image" content="https://bear-images.sfo2.cdn.digitaloceanspaces.com/herman-1683556668-0.png">


<!-- Twitter -->
<meta property="twitter:card" content="summary">
<meta property="twitter:url" content="https://jaysherby.com/randomizing-mac-addresses-with-networkmanager/">
<meta property="twitter:title" content="Randomizing My MAC Address With NetworkManager">
<meta property="twitter:description" content="My life is harder for knowing and caring about my own privacy and security.  For example, if you&#x27;ve ever connected to the wifi at a Starbucks using a laptop,...">
<meta property="twitter:image" content="https://bear-images.sfo2.cdn.digitaloceanspaces.com/herman-1683556668-0.png">



<!-- Microdata -->
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "article",
    "name": "Randomizing My MAC Address With NetworkManager",
    "headline": "Randomizing My MAC Address With NetworkManager",
    "url": "https://jaysherby.com/randomizing-mac-addresses-with-networkmanager/",
    "description": "My life is harder for knowing and caring about my own privacy and security.  For example, if you&#x27;ve ever connected to the wifi at a Starbucks using a laptop,...",
    "image": "https://bear-images.sfo2.cdn.digitaloceanspaces.com/herman-1683556668-0.png"
  }
</script>
    <link rel="alternate" type="application/atom+xml" href="../feed/index.html" title="Jay&#x27;s blog">
    <link rel="alternate" type="application/rss+xml" href="../feed/index.html%3Ftype=rss" title="Jay&#x27;s blog">

  
    

    
    <link rel="stylesheet" href="../static/pygmentify/css/default.min.css">
  
  
  
    
        <link rel="shortcut icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20100%20100'%3E%3Ctext%20y='.9em'%20font-size='90'%3EðŸ‘¨â€ðŸ’»%3C/text%3E%3C/svg%3E">
    



  <style>
      
      
    :root {
    --width: 800px;
    --font-main: Verdana, sans-serif;
    --font-secondary: Verdana, sans-serif;
    --font-scale: 1em;
    --background-color: #fff;
    --heading-color: #222;
    --text-color: #444;
    --link-color: #3273dc;
    --visited-color:  #8b6fcb;
    --code-background-color: #f2f2f2;
    --code-color: #222;
    --blockquote-color: #222;
}

@media (prefers-color-scheme: dark) {
    :root {
        --background-color: #01242e;
        --heading-color: #eee;
        --text-color: #ddd;
        --link-color: #8cc2dd;
        --visited-color:  #8b6fcb;
        --code-background-color: #000;
        --code-color: #ddd;
        --blockquote-color: #ccc;
    }
}

body {
    font-family: var(--font-secondary);
    font-size: var(--font-scale);
    margin: auto;
    padding: 20px;
    max-width: var(--width);
    text-align: left;
    background-color: var(--background-color);
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.5;
    color: var(--text-color);
}

h1, h2, h3, h4, h5, h6 {
    font-family: var(--font-main);
    color: var(--heading-color);
}

a {
    color: var(--link-color);
    cursor: pointer;
    text-decoration: none;
}

a:hover {
    text-decoration: underline; 
}

nav a {
    margin-right: 8px;
}

strong, b {
    color: var(--heading-color);
}

button {
    margin: 0;
    cursor: pointer;
}

main {
    line-height: 1.6;
}

table {
    width: 100%;
}

hr {
    border: 0;
    border-top: 1px dashed;
}

img {
    max-width: 100%;
}

code {
    font-family: monospace;
    padding: 2px;
    background-color: var(--code-background-color);
    color: var(--code-color);
    border-radius: 3px;
}

blockquote {
    border-left: 1px solid #999;
    color: var(--code-color);
    padding-left: 20px;
    font-style: italic;
}

footer {
    padding: 25px 0;
    text-align: center;
}

.title:hover {
    text-decoration: none;
}

.title h1 {
    font-size: 1.5em;
}

.inline {
    width: auto !important;
}

.highlight, .code {
    padding: 1px 15px;
    background-color: var(--code-background-color);
    color: var(--code-color);
    border-radius: 3px;
    margin-block-start: 1em;
    margin-block-end: 1em;
    overflow-x: auto;
}

/* blog post list */
ul.blog-posts {
    list-style-type: none;
    padding: unset;
}

ul.blog-posts li {
    display: flex;
}

ul.blog-posts li span {
    flex: 0 0 130px;
}

ul.blog-posts li a:visited {
    color: var(--visited-color);
}

/* Make embedded images centered and interrupt content */
main img {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

/* Give hint that <details> are clickable to reveal more */
details > summary {
  cursor: pointer;
}

/* Use Monokai code highlighting theme in dark mode */
@media (prefers-color-scheme: dark) {
  .hll { background-color: #49483e }
  .c { color: #75715e } /* Comment */
  .err { color: #960050; background-color: #1e0010 } /* Error */
  .k { color: #66d9ef } /* Keyword */
  .l { color: #ae81ff } /* Literal */
  .n { color: #f8f8f2 } /* Name */
  .o { color: #f92672 } /* Operator */
  .p { color: #f8f8f2 } /* Punctuation */
  .ch { color: #75715e } /* Comment.Hashbang */
  .cm { color: #75715e } /* Comment.Multiline */
  .cp { color: #75715e } /* Comment.Preproc */
  .cpf { color: #75715e } /* Comment.PreprocFile */
  .c1 { color: #75715e } /* Comment.Single */
  .cs { color: #75715e } /* Comment.Special */
  .gd { color: #f92672 } /* Generic.Deleted */
  .ge { font-style: italic } /* Generic.Emph */
  .gi { color: #a6e22e } /* Generic.Inserted */
  .gs { font-weight: bold } /* Generic.Strong */
  .gu { color: #75715e } /* Generic.Subheading */
  .kc { color: #66d9ef } /* Keyword.Constant */
  .kd { color: #66d9ef } /* Keyword.Declaration */
  .kn { color: #f92672 } /* Keyword.Namespace */
  .kp { color: #66d9ef } /* Keyword.Pseudo */
  .kr { color: #66d9ef } /* Keyword.Reserved */
  .kt { color: #66d9ef } /* Keyword.Type */
  .ld { color: #e6db74 } /* Literal.Date */
  .m { color: #ae81ff } /* Literal.Number */
  .s { color: #e6db74 } /* Literal.String */
  .na { color: #a6e22e } /* Name.Attribute */
  .nb { color: #f8f8f2 } /* Name.Builtin */
  .nc { color: #a6e22e } /* Name.Class */
  .no { color: #66d9ef } /* Name.Constant */
  .nd { color: #a6e22e } /* Name.Decorator */
  .ni { color: #f8f8f2 } /* Name.Entity */
  .ne { color: #a6e22e } /* Name.Exception */
  .nf { color: #a6e22e } /* Name.Function */
  .nl { color: #f8f8f2 } /* Name.Label */
  .nn { color: #f8f8f2 } /* Name.Namespace */
  .nx { color: #a6e22e } /* Name.Other */
  .py { color: #f8f8f2 } /* Name.Property */
  .nt { color: #f92672 } /* Name.Tag */
  .nv { color: #f8f8f2 } /* Name.Variable */
  .ow { color: #f92672 } /* Operator.Word */
  .w { color: #f8f8f2 } /* Text.Whitespace */
  .mb { color: #ae81ff } /* Literal.Number.Bin */
  .mf { color: #ae81ff } /* Literal.Number.Float */
  .mh { color: #ae81ff } /* Literal.Number.Hex */
  .mi { color: #ae81ff } /* Literal.Number.Integer */
  .mo { color: #ae81ff } /* Literal.Number.Oct */
  .sa { color: #e6db74 } /* Literal.String.Affix */
  .sb { color: #e6db74 } /* Literal.String.Backtick */
  .sc { color: #e6db74 } /* Literal.String.Char */
  .dl { color: #e6db74 } /* Literal.String.Delimiter */
  .sd { color: #e6db74 } /* Literal.String.Doc */
  .s2 { color: #e6db74 } /* Literal.String.Double */
  .se { color: #ae81ff } /* Literal.String.Escape */
  .sh { color: #e6db74 } /* Literal.String.Heredoc */
  .si { color: #e6db74 } /* Literal.String.Interpol */
  .sx { color: #e6db74 } /* Literal.String.Other */
  .sr { color: #e6db74 } /* Literal.String.Regex */
  .s1 { color: #e6db74 } /* Literal.String.Single */
  .ss { color: #e6db74 } /* Literal.String.Symbol */
  .bp { color: #f8f8f2 } /* Name.Builtin.Pseudo */
  .fm { color: #a6e22e } /* Name.Function.Magic */
  .vc { color: #f8f8f2 } /* Name.Variable.Class */
  .vg { color: #f8f8f2 } /* Name.Variable.Global */
  .vi { color: #f8f8f2 } /* Name.Variable.Instance */
  .vm { color: #f8f8f2 } /* Name.Variable.Magic */
  .il { color: #ae81ff } /* Literal.Number.Integer.Long */
}
    .upvote-button {
        padding: 0;
        margin: 0;
        border: 0;
        background-color: inherit;
        color: inherit;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .upvote-button.upvoted {
        color: salmon;
    }
    .upvote-count {
        margin-top: -3px;
    }

      
  </style>

  
    
    <script>
        window.addEventListener("load", (event) => {
            document.body.addEventListener('pointerover', () => {
                fetch(`/hit/mDyFTGFCPjKmngRjkbUQ${document.referrer && new URL(document.referrer).hostname !== "jaysherby.com" ? `?ref=${encodeURIComponent(document.referrer)}` : ""}`);
            }, { once: true });
        });
    </script>
    

</head>

<body class="post " onload="(function() { document.cookie = `timezone=${Intl.DateTimeFormat().resolvedOptions().timeZone};path=/`; })()">
  
  <header>
    <a class="title" href="../index.html">
      <h1>
        Jay&#x27;s blog
      </h1>
    </a>
    <nav>
      <p><a href='../index.html'>Home</a> <a href='../resume/index.html'>RÃ©sumÃ©</a> <a href='../blog/index.html'>Blog</a></p>

    </nav>
  </header>
  <main>
    

    

    
        <h1>Randomizing My MAC Address With NetworkManager</h1>

        <p>
            <i>
                <time datetime="2023-03-14T23:31Z">
    14 Mar, 2023
</time>
            </i>
        </p>
    

    <p>My life is harder for knowing and caring about my own privacy and security.  For example, if you've ever connected to the wifi at a Starbucks using a laptop, you'll have noticed the "captive portal" system they use.  That's the page that pops up before you can actually use the internet.  It asks you for your name, email address, and zip code.</p>
<p>You may also notice that once you fill out that form, you never have to do it again.  Every time you connect to the Starbucks wifi afterwards, it'll usually still give you a captive portal page, but you'll never have to "log in" again.  This usually holds true <em>even if you visit a different Starbucks with the same computer.</em></p>
<p>Guess what? Starbucks is tracking you.<sup class="footnote-ref" id="fnref-1"><a href="index.html#fn-1">1</a></sup> I don't like that, so I lie every time I fill out that form.<sup class="footnote-ref" id="fnref-2"><a href="index.html#fn-2">2</a></sup> <em>Or do I?</em> ðŸ˜‰</p>
<p>The way Starbucks remembers your computer is by recording the MAC address of your wifi adapter.</p>
<p>This is a very old, very well-known privacy risk. Most operating systems have made it relatively easy to spoof your MAC address with a semi-randomly generated one to mitigate this risk. Some even do this by default now.</p>
<p>Even so, I have particular preferences for how I prefer this feature to work that my system's default settings don't meet.</p>
<p>I'm using Pop!_OS, which uses NetworkManager.  I'll show you its default setup, how I changed it, and why.</p>
<p>Here's the default config, located at <code>/etc/NetworkManager/NetworkManager.conf</code>, that shipped with my machine:</p>
<div class="highlight"><pre><span></span>[main]
plugins=ifupdown,keyfile

[ifupdown]
managed=false

[device]
wifi.scan-rand-mac-address=no
</pre></div>
<p>Shame on you, Pop!_OS!  See <code>wifi.scan-rand-mac-address=no</code>?  That turns off MAC randomization during access point scanning! That means you're leaking your MAC address before you even connect to wifi. Passive listeners can track you. This isn't even the default behavior <a href='https://blogs.gnome.org/thaller/2016/08/26/mac-address-spoofing-in-networkmanager-1-4-0/'>as of NetworkManager 1.4.0</a>. This is pretty embarrassing. Even Android randomizes your MAC address when scanning nowadays.</p>
<p>Here are my changes:</p>
<div class="highlight"><pre><span></span>[main]
plugins=ifupdown,keyfile

[ifupdown]
managed=false

[device]
wifi.scan-rand-mac-address=yes

[connection]
ethernet.cloned-mac-address=random
wifi.cloned-mac-address=random
</pre></div>
<p>I changed <code>wifi.scan-rand-mac-address</code> to <code>yes</code>, even though it's the default behavior. Just to be extra sure.</p>
<p>I also added a setting called <code>cloned-mac-address</code> to both ethernet<sup class="footnote-ref" id="fnref-3"><a href="index.html#fn-3">3</a></sup> and wifi, and set it to <code>random</code>. This setting has a few other possible values. I'll quote the manual.</p>
<blockquote>
<p>Beside explicitly specifying a MAC address, the special values "preserve", "permanent", "random" and "stable" are supported. "preserve" means not to touch the MAC address on activation. "permanent" means to use the permanent hardware address if the device has one (otherwise this is treated as "preserve"). "random" creates a random MAC address on each connect. "stable" creates a hashed MAC address based on connection.stable-id and a machine dependent key.</p>
</blockquote>
<p>In other words, <code>permanent</code> and probably <code>preserve</code> will leak your physical MAC address when you connect to an access point. <code>stable</code> won't leak your physical MAC address, but it will result in a given access point seeing the same fake MAC address every time you connect to it.  That doesn't really prevent tracking if every Starbucks access point presents identically.<sup class="footnote-ref" id="fnref-4"><a href="index.html#fn-4">4</a></sup> I want <code>random</code>. It generates a new, random MAC address on every connection.</p>
<p>There. No more tracking. Now I just have to fill out that stupid captive portal form every time I go to Starbucks with my laptop.<sup class="footnote-ref" id="fnref-5"><a href="index.html#fn-5">5</a></sup></p>
<h2 id=but-what-if-my-router-yells-at-me>But what if my router yells at me?</h2><p>This happened to me. My Synology router started sending push notifications to my phone every time I turned on my laptop, asking me if I know this mysterious device that just connected.</p>
<p>I needed to make an exception to the rules, but just for this one wifi network.  Happily, the option to change this setting is actually in the GUI.</p>
<p><img src="../../bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby-1678841041-0.png" alt="Oh, no! I forgot to censor my home network's SSID!" /></p>
<p>You can see here I've set this particular connection to <code>stable</code>. Works like a charm.</p>
<p>I'm sure there's a way to do this on the command line, or in a configuration file somewhere, but I haven't needed to figure that out yet.</p>
<hr />
<section class="footnotes">
<ol>
<li id="fn-1"><p>I have no idea if Starbucks is actively using the data they're collecting, but they <em>are</em> collecting it. Even if it's just within log files. I mean, they wouldn't ask you a bunch of personal information if they weren't going to use it for <em>something</em>, right? I'm sure they tell you what they're doing with it in their T&C. But who reads those?<a href="index.html#fnref-1" class="footnote">&#8617;</a></p></li>
<li id="fn-2"><p>I've noticed that they'll deny you access if you make up random email domains. Gmail addresses seem to always work, though.<a href="index.html#fnref-2" class="footnote">&#8617;</a></p></li>
<li id="fn-3"><p>My laptop doesn't have a built-in ethernet port, so this is probably unnecessary. But it's not hurting anything, and it'll protect me in the one-in-a-million chance I ever plug in a USB-to-ethernet dongle.<a href="index.html#fnref-3" class="footnote">&#8617;</a></p></li>
<li id="fn-4"><p>And almost every Starbucks access point does present identically. This is why your phone or laptop will automatically connect to Starbucks wifi even if you've never been to that particular location before.<a href="index.html#fnref-4" class="footnote">&#8617;</a></p></li>
<li id="fn-5"><p>Yep.  I'm apparently willing to pay that price because I care that much about my privacy.  Do you think I like living this way?  I guess my Walter Mitty daydreams include living in the world of <em>Hackers (1995)</em>, and running Silk Road from coffee shops but <em>not</em> getting caught like Ulbricht did.<a href="index.html#fnref-5" class="footnote">&#8617;</a></p></li>
</ol>
</section>


    

    
        
            <p class="tags">
                
                    <a href="https://jaysherby.com/blog/?q=pop_os">#pop_os</a>
                
            </p>
        

        
            <form id="upvote-form" method="post" style="display: inline">
    <small>
        <input hidden name="uid" value="mDyFTGFCPjKmngRjkbUQ" style="display:none">
        <input hidden name="title" value="Randomizing My MAC Address With NetworkManager" style="display:none">

        <button
            class="upvote-button"
            title="Toast this post"
        >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1">
                <polyline points="17 11 12 6 7 11"></polyline>
                <polyline points="17 18 12 13 7 18"></polyline>
            </svg>
            <small class="upvote-count">&nbsp;</small>
        </button>
    </small>        
</form>

<script>
    const $upvoteButton = document.querySelector('.upvote-button');

    fetch('/upvote-info/mDyFTGFCPjKmngRjkbUQ/').then(response => response.json()).then(data => {
        document.querySelector('.upvote-count').innerText = data.upvote_count;
        if (data.upvoted) {
            $upvoteButton.disabled = true
            $upvoteButton.style.color = "salmon"
            $upvoteButton.title = "Toasted"
        }
    });

    let moved = false;
    let pageLoaded = Date.now();

    document.addEventListener('touchmove', () => moved = true);
    document.addEventListener('mousemove', () => moved = true);

    document.querySelector('#upvote-form').addEventListener('submit', (e) => {
        e.preventDefault();

        if (moved) {
            document.querySelector('input[name="title"]').value = "";
        }
        if (Date.now() - pageLoaded < 2000 || !moved) {
            return;
        }

        fetch("/upvote/mDyFTGFCPjKmngRjkbUQ/", {
            method: 'post',
            body: new FormData(e.target),
        });
        
        $upvoteButton.disabled = true
        $upvoteButton.style.color = "salmon"
        $upvoteButton.title = "Toasted"
        const upvoteCount = document.querySelector('.upvote-count')
        upvoteCount.innerHTML = `${(parseInt(upvoteCount.innerHTML.split(" ")[0]) + 1)}`
    });
</script>
        
    


  </main>
  <footer style="padding:25px 0;">
    
    
    <span>
        Powered by <a href="https://bearblog.dev">Bear <span role="img" class="bear" aria-label="ASCII bear logo">Ê•â€¢á´¥â€¢Ê”</span></a>
    </span>

  </footer>

  
  <script>
        const times = document.querySelectorAll('time');
        const format_string = "" || "d M, Y"

        times.forEach(time => {
            time.innerText = formatDate(time.dateTime, format_string)
        });

        function formatDate(dateStr, formatStr) {
            const date = new Date(dateStr);
            const day = date.getDate();
            const month = date.getMonth();
            const year = date.getFullYear();
            const weekday = date.getDay();
            const hours = date.getHours();
            const minutes = date.getMinutes();

            const monthsFull = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            const monthsShort = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const daysFull = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const daysShort = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

            function getOrdinal(n) {
            const s = ['th', 'st', 'nd', 'rd'];
            const v = n % 100;
            return s[(v - 20) % 10] || s[v] || s[0];
            }

            const map = {
            'd': () => day.toString().padStart(2, '0'),
            'm': () => (month + 1).toString().padStart(2, '0'),
            'Y': () => year.toString(),
            'F': () => monthsFull[month],
            'j': () => day.toString(),
            'D': () => daysShort[weekday],
            'l': () => daysFull[weekday],
            'S': () => getOrdinal(day),
            'M': () => monthsShort[month],
            'H': () => hours.toString().padStart(2, '0'),
            'h': () => {
                let h = hours % 12;
                h = h === 0 ? 12 : h;
                return h.toString().padStart(2, '0');
            },
            'i': () => minutes.toString().padStart(2, '0'),
            'a': () => hours < 12 ? 'am' : 'pm',
            };

            let result = '';
            for (let char of formatStr) {
                result += map[char] ? map[char]() : char;
            }
            return result;
        }
    </script>
    
</body>
</html>