<!DOCTYPE html>
<html lang="en">

<head>
  
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5">
  
  <title>The Two Most Popular Missing Typescript Features | Jay&#x27;s blog</title>
  <link rel="canonical" href="index.html">
  
    

    <meta name="jaysherby" content="look-for-the-bear-necessities">
    <meta name="token" content="cCkJtPEkTyYGxebKKVeh">

    <!-- Primary Meta Tags -->
<meta name="title" content="The Two Most Popular Missing Typescript Features">
<meta name="description" content="

There are two features I think should be in Typescript that are currently missing. It&#x27;s not just  opinion, either. When I was researching this blog post,...">

<!-- Open Graph / Facebook -->
<meta property="og:site_name" content="Jay&#x27;s blog">
<meta property="og:title" content="The Two Most Popular Missing Typescript Features">
<meta property="og:type" content="article">
<meta property="og:url" content="https://jaysherby.com/the-two-most-popular-missing-typescript-features/">
<meta property="og:description" content="

There are two features I think should be in Typescript that are currently missing. It&#x27;s not just  opinion, either. When I was researching this blog post,...">
<meta property="og:image" content="https://bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby-1680055815-0.png">


<!-- Twitter -->
<meta property="twitter:card" content="summary">
<meta property="twitter:url" content="https://jaysherby.com/the-two-most-popular-missing-typescript-features/">
<meta property="twitter:title" content="The Two Most Popular Missing Typescript Features">
<meta property="twitter:description" content="

There are two features I think should be in Typescript that are currently missing. It&#x27;s not just  opinion, either. When I was researching this blog post,...">
<meta property="twitter:image" content="https://bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby-1680055815-0.png">



<!-- Microdata -->
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "article",
    "name": "The Two Most Popular Missing Typescript Features",
    "headline": "The Two Most Popular Missing Typescript Features",
    "url": "https://jaysherby.com/the-two-most-popular-missing-typescript-features/",
    "description": "

There are two features I think should be in Typescript that are currently missing. It&#x27;s not just  opinion, either. When I was researching this blog post,...",
    "image": "https://bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby-1680055815-0.png"
  }
</script>
    <link rel="alternate" type="application/atom+xml" href="../feed/index.html" title="Jay&#x27;s blog">
    <link rel="alternate" type="application/rss+xml" href="../feed/index.html%3Ftype=rss" title="Jay&#x27;s blog">

  
    

    
    <link rel="stylesheet" href="../static/pygmentify/css/default.min.css">
  
  
  
    
        <link rel="shortcut icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20100%20100'%3E%3Ctext%20y='.9em'%20font-size='90'%3Eüë®‚Äçüíª%3C/text%3E%3C/svg%3E">
    



  <style>
      
      
    :root {
    --width: 800px;
    --font-main: Verdana, sans-serif;
    --font-secondary: Verdana, sans-serif;
    --font-scale: 1em;
    --background-color: #fff;
    --heading-color: #222;
    --text-color: #444;
    --link-color: #3273dc;
    --visited-color:  #8b6fcb;
    --code-background-color: #f2f2f2;
    --code-color: #222;
    --blockquote-color: #222;
}

@media (prefers-color-scheme: dark) {
    :root {
        --background-color: #01242e;
        --heading-color: #eee;
        --text-color: #ddd;
        --link-color: #8cc2dd;
        --visited-color:  #8b6fcb;
        --code-background-color: #000;
        --code-color: #ddd;
        --blockquote-color: #ccc;
    }
}

body {
    font-family: var(--font-secondary);
    font-size: var(--font-scale);
    margin: auto;
    padding: 20px;
    max-width: var(--width);
    text-align: left;
    background-color: var(--background-color);
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.5;
    color: var(--text-color);
}

h1, h2, h3, h4, h5, h6 {
    font-family: var(--font-main);
    color: var(--heading-color);
}

a {
    color: var(--link-color);
    cursor: pointer;
    text-decoration: none;
}

a:hover {
    text-decoration: underline; 
}

nav a {
    margin-right: 8px;
}

strong, b {
    color: var(--heading-color);
}

button {
    margin: 0;
    cursor: pointer;
}

main {
    line-height: 1.6;
}

table {
    width: 100%;
}

hr {
    border: 0;
    border-top: 1px dashed;
}

img {
    max-width: 100%;
}

code {
    font-family: monospace;
    padding: 2px;
    background-color: var(--code-background-color);
    color: var(--code-color);
    border-radius: 3px;
}

blockquote {
    border-left: 1px solid #999;
    color: var(--code-color);
    padding-left: 20px;
    font-style: italic;
}

footer {
    padding: 25px 0;
    text-align: center;
}

.title:hover {
    text-decoration: none;
}

.title h1 {
    font-size: 1.5em;
}

.inline {
    width: auto !important;
}

.highlight, .code {
    padding: 1px 15px;
    background-color: var(--code-background-color);
    color: var(--code-color);
    border-radius: 3px;
    margin-block-start: 1em;
    margin-block-end: 1em;
    overflow-x: auto;
}

/* blog post list */
ul.blog-posts {
    list-style-type: none;
    padding: unset;
}

ul.blog-posts li {
    display: flex;
}

ul.blog-posts li span {
    flex: 0 0 130px;
}

ul.blog-posts li a:visited {
    color: var(--visited-color);
}

/* Make embedded images centered and interrupt content */
main img {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

/* Give hint that <details> are clickable to reveal more */
details > summary {
  cursor: pointer;
}

/* Use Monokai code highlighting theme in dark mode */
@media (prefers-color-scheme: dark) {
  .hll { background-color: #49483e }
  .c { color: #75715e } /* Comment */
  .err { color: #960050; background-color: #1e0010 } /* Error */
  .k { color: #66d9ef } /* Keyword */
  .l { color: #ae81ff } /* Literal */
  .n { color: #f8f8f2 } /* Name */
  .o { color: #f92672 } /* Operator */
  .p { color: #f8f8f2 } /* Punctuation */
  .ch { color: #75715e } /* Comment.Hashbang */
  .cm { color: #75715e } /* Comment.Multiline */
  .cp { color: #75715e } /* Comment.Preproc */
  .cpf { color: #75715e } /* Comment.PreprocFile */
  .c1 { color: #75715e } /* Comment.Single */
  .cs { color: #75715e } /* Comment.Special */
  .gd { color: #f92672 } /* Generic.Deleted */
  .ge { font-style: italic } /* Generic.Emph */
  .gi { color: #a6e22e } /* Generic.Inserted */
  .gs { font-weight: bold } /* Generic.Strong */
  .gu { color: #75715e } /* Generic.Subheading */
  .kc { color: #66d9ef } /* Keyword.Constant */
  .kd { color: #66d9ef } /* Keyword.Declaration */
  .kn { color: #f92672 } /* Keyword.Namespace */
  .kp { color: #66d9ef } /* Keyword.Pseudo */
  .kr { color: #66d9ef } /* Keyword.Reserved */
  .kt { color: #66d9ef } /* Keyword.Type */
  .ld { color: #e6db74 } /* Literal.Date */
  .m { color: #ae81ff } /* Literal.Number */
  .s { color: #e6db74 } /* Literal.String */
  .na { color: #a6e22e } /* Name.Attribute */
  .nb { color: #f8f8f2 } /* Name.Builtin */
  .nc { color: #a6e22e } /* Name.Class */
  .no { color: #66d9ef } /* Name.Constant */
  .nd { color: #a6e22e } /* Name.Decorator */
  .ni { color: #f8f8f2 } /* Name.Entity */
  .ne { color: #a6e22e } /* Name.Exception */
  .nf { color: #a6e22e } /* Name.Function */
  .nl { color: #f8f8f2 } /* Name.Label */
  .nn { color: #f8f8f2 } /* Name.Namespace */
  .nx { color: #a6e22e } /* Name.Other */
  .py { color: #f8f8f2 } /* Name.Property */
  .nt { color: #f92672 } /* Name.Tag */
  .nv { color: #f8f8f2 } /* Name.Variable */
  .ow { color: #f92672 } /* Operator.Word */
  .w { color: #f8f8f2 } /* Text.Whitespace */
  .mb { color: #ae81ff } /* Literal.Number.Bin */
  .mf { color: #ae81ff } /* Literal.Number.Float */
  .mh { color: #ae81ff } /* Literal.Number.Hex */
  .mi { color: #ae81ff } /* Literal.Number.Integer */
  .mo { color: #ae81ff } /* Literal.Number.Oct */
  .sa { color: #e6db74 } /* Literal.String.Affix */
  .sb { color: #e6db74 } /* Literal.String.Backtick */
  .sc { color: #e6db74 } /* Literal.String.Char */
  .dl { color: #e6db74 } /* Literal.String.Delimiter */
  .sd { color: #e6db74 } /* Literal.String.Doc */
  .s2 { color: #e6db74 } /* Literal.String.Double */
  .se { color: #ae81ff } /* Literal.String.Escape */
  .sh { color: #e6db74 } /* Literal.String.Heredoc */
  .si { color: #e6db74 } /* Literal.String.Interpol */
  .sx { color: #e6db74 } /* Literal.String.Other */
  .sr { color: #e6db74 } /* Literal.String.Regex */
  .s1 { color: #e6db74 } /* Literal.String.Single */
  .ss { color: #e6db74 } /* Literal.String.Symbol */
  .bp { color: #f8f8f2 } /* Name.Builtin.Pseudo */
  .fm { color: #a6e22e } /* Name.Function.Magic */
  .vc { color: #f8f8f2 } /* Name.Variable.Class */
  .vg { color: #f8f8f2 } /* Name.Variable.Global */
  .vi { color: #f8f8f2 } /* Name.Variable.Instance */
  .vm { color: #f8f8f2 } /* Name.Variable.Magic */
  .il { color: #ae81ff } /* Literal.Number.Integer.Long */
}
    .upvote-button {
        padding: 0;
        margin: 0;
        border: 0;
        background-color: inherit;
        color: inherit;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    .upvote-button.upvoted {
        color: salmon;
    }
    .upvote-count {
        margin-top: -3px;
    }

      
  </style>
</head>

<body class="post " onload="(function() { document.cookie = `timezone=${Intl.DateTimeFormat().resolvedOptions().timeZone};path=/`; })()">
  
  <header>
    <a class="title" href="../index.html">
      <h1>
        Jay&#x27;s blog
      </h1>
    </a>
    <nav>
      <p><a href='../index.html'>Home</a> <a href='../resume/index.html'>R√©sum√©</a> <a href='../blog/index.html'>Blog</a></p>

    </nav>
  </header>
  <main>
    

    

    
        <h1>The Two Most Popular Missing Typescript Features</h1>

        <p>
            <i>
                <time datetime="2023-03-28T18:43Z">
    28 Mar, 2023
</time>
            </i>
        </p>
    

    <p><img src="../../bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby-1680055815-0.png" alt="" title="Original art, the suspense is terrible, I hope it'll last" /></p>
<p>There are two features I think should be in Typescript that are currently missing. It's not just <em>my</em> opinion, either. When I was researching this blog post, I discovered that the tickets requesting these two features are the most discussed tickets with the "suggestion" tag still open. If I could wave a magic wand to change Typescript in any way, I'd add these two features.</p>
<h2 id=a-hrefhttpsgithubcommicrosofttypescriptissues1321913219a-codethrowscode-clause-and-typed-catch-clause><a href='https://github.com/microsoft/TypeScript/issues/13219'>#13219</a> <code>throws</code> clause and typed catch clause</h2><p>This missing feature came up in discussion on a pull request of mine at work this week. A particular function had a return type of <code>Promise&lt;boolean&gt;</code> and included a <code>try...catch</code> statement in its body. A friend and colleague<sup class="footnote-ref" id="fnref-1"><a href="index.html#fn-1">1</a></sup> left a comment asking why the possible error types weren't represented in the return type of the function. Maybe something like <code>Promise&lt;boolean, AppException&gt;</code>?</p>
<p>The answer is that the <code>Promise</code> type doesn't support a second type variable to describe the value returned on rejection of a promise.</p>
<p>As I suspected, the lack of a rejection type mirrors how caught error types are handled. (Or should I say, not handled?)</p>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// Code that might throw</span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="c1">// What is the type of `e`?</span>
<span class="p">}</span>
</pre></div>
<p>Depending on the version of Typescript you're using and how you have configured it, the type of <code>e</code> in the code above is either <code>any</code> or <code>unknown</code>.</p>
<p>That's pretty unsatisfying to me, and it leads to a lot of boilerplate in every <code>catch</code> block where I have to write a bunch of <code>if</code> blocks to detect the type of <code>e</code> and handle it appropriately. And I still have to cover my ass in case I missed a type. I have no way of being absolutely sure I covered everything that might have been thrown.</p>
<p>JavaScript is particularly annoying when it comes to <code>throw</code>-ing things because almost any value can be thrown, not just sub-types of <code>Error</code>. You can throw strings, numbers, null. Almost anything your heart desires.<sup class="footnote-ref" id="fnref-2"><a href="index.html#fn-2">2</a></sup></p>
<p>I'd prefer it if Typescript could tell me all the possible types that might be thrown by a particular function or block of code. And I'm not alone. 1,349 people have given the üëç reaction to <a href='https://github.com/microsoft/TypeScript/issues/13219'>microsoft/Typescript#13219</a>.</p>
<p>The syntax suggested mirrors a feature already present in crusty, old Java.</p>
<div class="highlight"><pre><span></span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">fetchFile</span><span class="p">()</span><span class="w"> </span><span class="kd">throws</span><span class="w"> </span><span class="n">IOException</span><span class="p">,</span><span class="w"> </span><span class="n">NullPointerException</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// code that can throw IOException</span>

<span class="w">    </span><span class="c1">// code that can throw NullPointerException</span>
<span class="p">}</span>
</pre></div>
<p>The big upshot of this feature in Java, besides your tools being able to warn you when you're not handling something your code might throw, is it enables the following type of <code>try...catch</code> syntax.</p>
<div class="highlight"><pre><span></span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">fetchFile</span><span class="p">();</span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">IOException</span><span class="w"> </span><span class="n">ex1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// handle IOException appropriately</span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">NullPointerException</span><span class="w"> </span><span class="n">ex2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// handle NullPointerException appropriately</span>
<span class="p">}</span>
</pre></div>
<p>I vastly prefer this syntax over a single <code>catch</code> block containing repeated <code>if...else</code> blocks with <code>e instanceof AppError</code> conditions to detect each type. It's important to note that <a href='https://github.com/microsoft/TypeScript/issues/13219'>microsoft/Typescript#13219</a> <em>does not</em> include this new <code>try...catch</code> syntax. I couldn't find a ticket requesting such a feature. But adding the <code>throws</code> annotation to function signatures might set the stage for it.</p>
<p>When might we see the <code>throws</code> clause in Typescript? I wouldn't hold my breath. This ticket has been open for 7 years! But a boy can dream, can't he?</p>
<h2 id=a-hrefhttpsgithubcommicrosofttypescriptissues202202a-nominal-types><a href='https://github.com/microsoft/TypeScript/issues/202'>#202</a> Nominal types</h2><p>Typescript has a structural type system. What does this mean?</p>
<div class="highlight"><pre><span></span><span class="kd">interface</span><span class="w"> </span><span class="nx">Car</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">Dog</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">  </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="w">  </span><span class="nx">breed</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">announceCar</span><span class="p">(</span><span class="nx">car</span><span class="o">:</span><span class="w"> </span><span class="kt">Car</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`The </span><span class="si">${</span><span class="nx">car</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb"> is a </span><span class="si">${</span><span class="nx">car</span><span class="p">.</span><span class="nx">age</span><span class="si">}</span><span class="sb"> year old car.`</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">dodgeViper</span><span class="o">:</span><span class="w"> </span><span class="kt">Car</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Dodge Viper&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="kt">31</span><span class="p">,</span>
<span class="p">};</span>

<span class="nx">announceCar</span><span class="p">(</span><span class="nx">dodgeViper</span><span class="p">);</span>
<span class="c1">// The Dodge Viper is a 31 year old car.</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">brunoTheDog</span><span class="o">:</span><span class="w"> </span><span class="kt">Dog</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Bruno&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="kt">5</span><span class="p">,</span>
<span class="w">  </span><span class="nx">breed</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;terrier&#39;</span><span class="p">,</span>
<span class="p">};</span>

<span class="nx">announceCar</span><span class="p">(</span><span class="nx">brunoTheDog</span><span class="p">);</span><span class="w"> </span><span class="c1">// &lt;- Typescript is a-okay with this.</span>
<span class="c1">// The Bruno is a 5 year old car.</span>
</pre></div>
<p>So, uh... that was weird. I passed a <code>Dog</code> value to the <code>announceCar</code> function, which says it accepts a <code>Car</code> value. And Typescript was fine with it.</p>
<p>That's because <code>Dog</code> is structurally compatible with <code>Car</code>. <code>Dog</code> has the same structural properties as <code>Car</code>, plus a <code>breed</code> key. Anything that expects a <code>Car</code> can also accept a <code>Dog</code>. A <code>Car</code> can't pass as a <code>Dog</code>, though, because <code>Car</code> is missing the <code>breed</code> key.</p>
<p>Compare that to C, which has a nominal type system.</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">Car</span><span class="p">;</span>

<span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">name</span><span class="p">;</span>
<span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">age</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="n">Dog</span><span class="p">;</span>

<span class="kt">void</span><span class="w"> </span><span class="nf">announce_car</span><span class="p">(</span><span class="n">Car</span><span class="w"> </span><span class="o">*</span><span class="n">car</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;The %s is a %d year old car.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">car</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">car</span><span class="o">-&gt;</span><span class="n">age</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">Car</span><span class="w"> </span><span class="n">dodge_viper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">.</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Dodge Viper&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">.</span><span class="n">age</span><span class="o">=</span><span class="mi">31</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="n">announce_car</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dodge_viper</span><span class="p">);</span>
<span class="w">  </span><span class="c1">// The Dodge Viper is a 31 year old car.</span>

<span class="w">  </span><span class="n">Dog</span><span class="w"> </span><span class="n">bruno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="p">.</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;Bruno&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">.</span><span class="n">age</span><span class="o">=</span><span class="mi">5</span>
<span class="w">  </span><span class="p">};</span>

<span class="w">  </span><span class="n">announce_car</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bruno</span><span class="p">);</span>
<span class="w">  </span><span class="cm">/*</span>
<span class="cm">   * main.c:31:16: error: incompatible pointer types passing &#39;Dog *&#39; to parameter of type &#39;Car *&#39; [-Werror,-Wincompatible-pointer-types]</span>
<span class="cm">   *   announce_car(&amp;bruno);</span>
<span class="cm">   *                ^~~~~~</span>
<span class="cm">   * main.c:13:24: note: passing argument to parameter &#39;car&#39; here</span>
<span class="cm">   * void announce_car(Car *car) {</span>
<span class="cm">   *                        ^</span>
<span class="cm">   */</span>

<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>This C program is almost identical to the Typescript code, except that I've made the <code>Car</code> and <code>Dog</code> types structurally identical to one another. C does not let me pass a <code>Dog</code> to the <code>announce_car</code> function.<sup class="footnote-ref" id="fnref-3"><a href="index.html#fn-3">3</a></sup> If I really wanted to pass a <code>Dog</code> to <code>announce_car</code> in a nominally typed language, I'd have to cast it to a <code>Car</code> or manually create a new <code>Car</code> with the values from my <code>Dog</code>.</p>
<p>IMHO, unless you already understand the difference between structural typing and nominal typing, <a href='https://github.com/microsoft/TypeScript/issues/202'>microsoft/Typescript#202</a> doesn't do a very good job explaining it. But the feature being requested is the ability to opt into nominal typing for a given type. If I could specify that <code>Car</code> is a nominal type and a function expects a <code>Car</code>, you'd need to either give it a <code>Car</code> or cast the value you're passing into a <code>Car</code> first.</p>
<p>But... why? Why do people want this feature so badly?</p>
<p>Let me give you the most concrete example I've seen for why nominal typing could be so helpful.</p>
<div class="highlight"><pre><span></span><span class="kr">type</span><span class="w"> </span><span class="nx">CarID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">Car</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">CarID</span><span class="p">;</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">    </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">type</span><span class="w"> </span><span class="nx">DogID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>

<span class="kd">interface</span><span class="w"> </span><span class="nx">Dog</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">DogID</span><span class="p">;</span>
<span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">    </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">loadCar</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">CarID</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Car</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Loads a Car from the database</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Car</span><span class="p">;</span><span class="w"> </span><span class="c1">// Pretend this actually works</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">updateCarName</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">CarID</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Car</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Sets a Car&#39;s name in the database</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Car</span><span class="p">;</span><span class="w"> </span><span class="c1">// Pretend this actually works</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">loadDog</span><span class="p">(</span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">DogID</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">Dog</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Loads a Dog from the database</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Dog</span><span class="p">;</span><span class="w"> </span><span class="c1">// Pretend this actually works</span>
<span class="p">}</span>

<span class="kd">let</span><span class="w"> </span><span class="nx">bruno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">loadDog</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>

<span class="nx">updateCarName</span><span class="p">(</span><span class="nx">bruno</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Chevy Bel Air&quot;</span><span class="p">);</span>
</pre></div>
<p>The problem is in the last line. I'm passing a <code>DogID</code> to a function that expects a <code>CarID</code>. This is incorrect and can cause serious data corruption in my database. Typescript doesn't flag this as incorrect currently. Because Typescript's type system is structural, <code>type CarID = number;</code> causes <code>CarID</code> to be nothing more than a synonym for <code>number</code>.</p>
<p>Although <code>CarID</code> and <code>DogID</code> are technically both numbers, they are <em>not</em> semantically identical. If they could be declared as nominal types, Typescript would flag my attempt to pass <code>bruno.id</code> to <code>updateCarName</code> as a type error.</p>
<p>If I was really, <em>really</em> sure that I was doing the right thing, I could make Typescript accept it by casting, like this:</p>
<div class="highlight"><pre><span></span><span class="nx">updateCarName</span><span class="p">(</span><span class="nx">bruno</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">CarID</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Chevy Bel Air&quot;</span><span class="p">);</span>
</pre></div>
<p>This may seem like an odd concept, having explicit nominal types in an otherwise structural type system. I tried searching for prior art, but I didn't really find anything that works quite like what's being proposed in <a href='https://github.com/microsoft/TypeScript/issues/202'>microsoft/Typescript#202</a>. In Elm, you can achieve a similar effect using algebraic data types. Typescript doesn't support algebraic data types and it likely never will as that's a whole different beast.<sup class="footnote-ref" id="fnref-4"><a href="index.html#fn-4">4</a></sup> Flow treats classes as nominal types, but that's all. It's not something you can opt into for basic types like numbers.</p>
<p>If you read through the <a href='https://github.com/microsoft/TypeScript/issues/202'>microsoft/Typescript#202</a> ticket, you'll see plenty of people's attempts to achieve the desired effect using Typescript as it exists today. There are also plenty of options available on NPM. The general technique goes by many names: opaque types, branded types, tagged types, flavored types, etc. There are multiple variations on the theme that have their own advantages and drawbacks. While the more mainstream implementations are serviceable, I'd wager the concept would be easier to work with as a first-class feature of the language.<sup class="footnote-ref" id="fnref-5"><a href="index.html#fn-5">5</a></sup></p>
<p>How does this feature request compare to the <code>throws</code> feature request from the first half of this blog post? It has fewer üëç reactions, but more discussion. As the issue number implies, it's been around longer. A whole 9 years! Looking at the request honestly, I think nominal types would be less impactful for the average developer than the <code>throws</code> feature. But it would still be a nice addition because it could help eliminate an entire class of bugs if used diligently.</p>
<hr />
<section class="footnotes">
<ol>
<li id="fn-1"><p>Shout out to Emily! Thanks for the great question and the inspiration for this blog post. ‚ù§Ô∏è<a href="index.html#fnref-1" class="footnote">&#8617;</a></p></li>
<li id="fn-2"><p>Interestingly, you can't throw <code>void</code>. Thank goodness for small favors, I guess.<a href="index.html#fnref-2" class="footnote">&#8617;</a></p></li>
<li id="fn-3"><p>Well, it would let me pass a <code>Dog</code> to <code>announce_car</code> if I hadn't compiled it with the <code>-Werror</code> flag. In that case, the compiler emits the same message as a warning and lets me do it anyway, which does work. But it only works because the types are literally the same. If I add a <code>breed</code> field to <code>Dog</code> after <code>name</code> but before <code>age</code> and set <code>breed</code> to "terrier", <code>announce_car</code> will emit "The Bruno is a 4195924 year old car." But that's beyond the scope of the point I'm trying to make here.<a href="index.html#fnref-3" class="footnote">&#8617;</a></p></li>
<li id="fn-4"><p>FWIW, I love algebraic data types. I think they're more expressive than what Typescript currently has. But I don't think ADTs can map cleanly onto JavaScript's type system, meaning it's incompatible with Typescript's design goals.<a href="index.html#fnref-4" class="footnote">&#8617;</a></p></li>
<li id="fn-5"><p>The way most opaque type implementations work amounts to lying to the type system. Take <a href='https://github.com/ts-essentials/ts-essentials/tree/master/lib/opaque'>the implementation from ts-essentials</a> for example. The implementation is only 9 lines long. It's got some interesting conditional types in there. I'm not exactly sure what bug it's trying to protect against. At the end of the day, the actual, literal type of <code>Opaque&lt;number, 'CarID'&gt;</code> would be <code>number &amp; { [__OPAQUE_TYPE__]: 'CarID' }</code>. But that's a lie. Numeric literals are "turned into" the opaque type via assertion: <code>5 as CarID</code>. There is no <code>__OPAQUE_TYPE__</code> on the value. <code>(1 as UserID)[__OPAQUE_TYPE__]</code> is valid according to the compiler. The ts-essentials implementation prevents us from being able to call its bluff by declaring <code>__OPAQUE_TYPE__</code> as a unique symbol that's never actually created or given a value, much less exported, so it's impossible to actually access that value since there's no way to access it. <a href='https://www.typescriptlang.org/play?#code/C4TwDgpgBAysBOBLAdgcwDKOBeBDANgDwAq4EAfFALxSmRQQAe2yAJgM5TsIqpQD8UABTckaBswhtOdaIOQQAbjigAuWmQCUaqAuXwA3ACgjrCAGN8ueNHMB7ZNygB9ZwHkACgEEAigFUAUWdiAE0PIOd1AFdkRABHKOh2EABbACM7fGMjUHoAdSwACzcwXASIEjsAaykJFg4uHjRKGgBvIygoG1xWB3wQKABtV09fQOCwiIBddWJqqWMAX2zc6BKyxJIyABpaeeQ6qQbRXha9moOmes44MQwsHAJKi8pBWSgAMigC4GLS8ueUko6j0OBWZCgAGFrABJAAi1Cg6wByCi6RwuwA5ND4PDMeRsvgIMAoIhWABGdQ4+GI8lQXCcalw7L2RyZCAAOnwdlQQjJ5OG7m8-iCoXCrimmgMQA'>Try it in the playground</a> to see what I mean. I've copied and pasted the code from ts-essentials. It compiles fine but throws an error at runtime.<a href="index.html#fnref-5" class="footnote">&#8617;</a></p></li>
</ol>
</section>


    

    
        
            <p class="tags">
                
                    <a rel="nofollow" href="https://jaysherby.com/blog/?q=programming&#32;language&#32;theory">#programming language theory</a>
                
                    <a rel="nofollow" href="https://jaysherby.com/blog/?q=typescript">#typescript</a>
                
            </p>
        

        
            <form id="upvote-form" action="https://jaysherby.com/upvote/" method="post" style="display: inline">
    <small>
        <input hidden name="uid" value="cCkJtPEkTyYGxebKKVeh" style="display:none">
        <input hidden name="title" value="The Two Most Popular Missing Typescript Features" style="display:none">

        <button
            class="upvote-button"
            aria-label="Toast this post"
            title="Toast this post"
        >
            <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1">
                <polyline points="17 11 12 6 7 11"></polyline>
                <polyline points="17 18 12 13 7 18"></polyline>
            </svg>
            <small class="upvote-count" aria-hidden="true">&nbsp;</small>
        </button>
    </small>        
</form>

<script>
    const $upvoteButton = document.querySelector('.upvote-button');
    const $upvoteCount =  document.querySelector('.upvote-count')

    fetch('/upvote-info/cCkJtPEkTyYGxebKKVeh/').then(response => response.json()).then(data => {
        $upvoteCount.innerText = data.upvote_count;
        if (data.upvoted) {
            $upvoteButton.disabled = true
            $upvoteButton.style.color = "salmon"
            $upvoteButton.ariaLabel = "Toasted"
            $upvoteButton.title = "Toasted"
        }
        $upvoteButton.ariaLabel += ` (${data.upvote_count})`
    });

    let moved = false;
    let pageLoaded = Date.now();

    document.addEventListener('touchmove', () => moved = true);
    document.addEventListener('mousemove', () => moved = true);

    document.querySelector('#upvote-form').addEventListener('submit', (e) => {
        e.preventDefault();

        if (moved) {
            document.querySelector('input[name="title"]').value = "";
        }
        if (Date.now() - pageLoaded < 2000 || !moved) {
            return;
        }

        fetch(e.target.action, {
            method: 'post',
            body: new FormData(e.target),
        });
        
        $upvoteButton.disabled = true
        $upvoteButton.style.color = "salmon"
        $upvoteButton.ariaLabel = "Toasted"
        $upvoteButton.title = "Toasted"
        const newUpvoteCount = `${(parseInt($upvoteCount.innerHTML.split(" ")[0]) + 1)}`
        $upvoteCount.innerHTML = newUpvoteCount
        $upvoteButton.ariaLabel += ` (${newUpvoteCount})`
    });
</script>
        

        
            <script>
            window.addEventListener("load", () => {
                if (navigator.webdriver !== true) {
                    const sendHit = score => {
                        const params = new URLSearchParams({
                            blog: "jaysherby",
                            token: "cCkJtPEkTyYGxebKKVeh",
                            referrer: document.referrer.includes("jaysherby.com") ? "" : document.referrer,
                            title: "",
                            score: score
                        });
                        new Image().src = `/hit/?${params.toString()}`;
                    };

                    document.addEventListener('touchmove', () => sendHit(100), { once: true });
                    document.addEventListener('mousemove', () => sendHit(100), { once: true });
                }
            });
            </script>
        
    


  </main>
  <footer>
    
    
    <span>
        Powered by <a href="https://bearblog.dev">Bear <span role="img" class="bear" aria-label="ASCII bear logo"> ï‚Ä¢·¥•‚Ä¢ î</span></a>
    </span>

  </footer>

  
  <script>
        (() => {
          "use strict";
          const times = document.querySelectorAll('time');
          const format_string = "" || "d M, Y"

          times.forEach(time => {
              time.innerText = formatDate(time.dateTime, format_string)
          });

          function formatDate(dateStr, formatStr) {
            const date = new Date(dateStr);
            const day = date.getDate();
            const month = date.getMonth();
            const year = date.getFullYear();
            const weekday = date.getDay();
            const hours = date.getHours();
            const minutes = date.getMinutes();
            const monthsFull = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            const monthsShort = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const daysFull = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const daysShort = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            
            function getOrdinal(n) {
                const s = ['th', 'st', 'nd', 'rd'];
                const v = n % 100;
                return s[(v - 20) % 10] || s[v] || s[0];
            }
            
            const map = {
                'd': () => day.toString().padStart(2, '0'),
                'm': () => (month + 1).toString().padStart(2, '0'),
                'Y': () => year.toString(),
                'y': () => year.toString().slice(-2),
                'F': () => monthsFull[month],
                'j': () => day.toString(),
                'D': () => daysShort[weekday],
                'l': () => daysFull[weekday],
                'S': () => getOrdinal(day),
                'M': () => monthsShort[month],
                'H': () => hours.toString().padStart(2, '0'),
                'h': () => {
                    let h = hours % 12;
                    h = h === 0 ? 12 : h;
                    return h.toString().padStart(2, '0');
                },
                'g': () => {
                    let h = hours % 12;
                    return h === 0 ? '12' : h.toString();
                },
                'i': () => minutes.toString().padStart(2, '0'),
                'a': () => hours < 12 ? 'am' : 'pm',
                'A': () => hours < 12 ? 'AM' : 'PM',
            };
            
            let result = '';
            for (let char of formatStr) {
                result += map[char] ? map[char]() : char;
            }
            return result;
        }
        })();
    </script>
    
</body>
</html>