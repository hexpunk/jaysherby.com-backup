<!DOCTYPE html>
<html lang="en">

<head>
  
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5">
  
  <title>Back That Blog Up | Jay&#x27;s blog</title>
  <link rel="canonical" href="index.html">
  


<meta name="jaysherby" content="look-for-the-bear-necessities">

<!-- Primary Meta Tags -->
<meta name="title" content="Back That Blog Up">
<meta name="description" content="There was a post on Hacker News about a week ago titled &quot;Ask HN: What has your personal website/blog done for you?&quot;. As someone who has tried to blog for yea...">

<!-- Open Graph / Facebook -->
<meta property="og:site_name" content="Jay&#x27;s blog">
<meta property="og:title" content="Back That Blog Up">
<meta property="og:type" content="article">
<meta property="og:url" content="https://jaysherby.com/back-that-blog-up/">
<meta property="og:description" content="There was a post on Hacker News about a week ago titled &quot;Ask HN: What has your personal website/blog done for you?&quot;. As someone who has tried to blog for yea...">

  <meta property="og:image" content="https://bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby-1679543245-0.png">


<!-- Twitter -->
<meta property="twitter:card" content="summary">
<meta property="twitter:url" content="https://jaysherby.com/back-that-blog-up/">
<meta property="twitter:title" content="Back That Blog Up">
<meta property="twitter:description" content="There was a post on Hacker News about a week ago titled &quot;Ask HN: What has your personal website/blog done for you?&quot;. As someone who has tried to blog for yea...">

  <meta property="twitter:image" content="https://bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby-1679543245-0.png">



<!-- Microdata -->
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "article",
    "name": "Back That Blog Up",
    "url": "https://jaysherby.com/back-that-blog-up/",
    "description": "There was a post on Hacker News about a week ago titled &quot;Ask HN: What has your personal website/blog done for you?&quot;. As someone who has tried to blog for yea...",
    "about": {
      "@type": "Back That Blog Up",
      "description": "There was a post on Hacker News about a week ago titled &quot;Ask HN: What has your personal website/blog done for you?&quot;. As someone who has tried to blog for yea..."
    }
  }
</script>

  






<link rel="stylesheet" href="../static/pygmentify/css/default.min.css">

  
  <link rel="shortcut icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20100%20100'%3E%3Ctext%20y='.9em'%20font-size='90'%3Eüë®‚Äçüíª%3C/text%3E%3C/svg%3E">

  <style>
      
      
:root {
    --width: 800px;
    --font-main: Verdana, sans-serif;
    --font-secondary: Verdana, sans-serif;
    --font-scale: 1em;
    --background-color: #fff;
    --heading-color: #222;
    --text-color: #444;
    --link-color: #3273dc;
    --visited-color:  #8b6fcb;
    --code-background-color: #f2f2f2;
    --code-color: #222;
    --blockquote-color: #222;
}

@media (prefers-color-scheme: dark) {
    :root {
        --background-color: #01242e;
        --heading-color: #eee;
        --text-color: #ddd;
        --link-color: #8cc2dd;
        --visited-color:  #8b6fcb;
        --code-background-color: #000;
        --code-color: #ddd;
        --blockquote-color: #ccc;
    }
}

body {
    font-family: var(--font-secondary);
    font-size: var(--font-scale);
    margin: auto;
    padding: 20px;
    max-width: var(--width);
    text-align: left;
    background-color: var(--background-color);
    word-wrap: break-word;
    overflow-wrap: break-word;
    line-height: 1.5;
    color: var(--text-color);
}

h1, h2, h3, h4, h5, h6 {
    font-family: var(--font-main);
    color: var(--heading-color);
}

a {
    color: var(--link-color);
    cursor: pointer;
    text-decoration: none;
}

a:hover {
    text-decoration: underline; 
}

nav a {
    margin-right: 8px;
}

strong, b {
    color: var(--heading-color);
}

button {
    margin: 0;
    cursor: pointer;
}

main {
    line-height: 1.6;
}

table {
    width: 100%;
}

hr {
    border: 0;
    border-top: 1px dashed;
}

img {
    max-width: 100%;
}

code {
    font-family: monospace;
    padding: 2px;
    background-color: var(--code-background-color);
    color: var(--code-color);
    border-radius: 3px;
}

blockquote {
    border-left: 1px solid #999;
    color: var(--code-color);
    padding-left: 20px;
    font-style: italic;
}

footer {
    padding: 25px 0;
    text-align: center;
}

.title:hover {
    text-decoration: none;
}

.title h1 {
    font-size: 1.5em;
}

.inline {
    width: auto !important;
}

.highlight, .code {
    padding: 1px 15px;
    background-color: var(--code-background-color);
    color: var(--code-color);
    border-radius: 3px;
    margin-block-start: 1em;
    margin-block-end: 1em;
    overflow-x: auto;
}

/* blog post list */
ul.blog-posts {
    list-style-type: none;
    padding: unset;
}

ul.blog-posts li {
    display: flex;
}

ul.blog-posts li span {
    flex: 0 0 130px;
}

ul.blog-posts li a:visited {
    color: var(--visited-color);
}
/* Blockquote styles for conversations with AI */
blockquote.me,
blockquote.them {
  border: 0;
  box-shadow: 4px 4px 16px rgba(0, 0, 0, 0.3);
  font: inherit;
  padding: 0 16px;
  
  /* Prevent margin collapse */
  overflow: hidden;
}

blockquote.me::before,
blockquote.them::before {
  float: left;
  margin: 16px 8px 0 0;
}

blockquote.me {
  background-color: #1e3a8a;
  border-radius: 10px 10px 0 10px;
  color: #ddd;
  margin: 20px 0 20px 20%;
}

blockquote.me::before {
  content: "üë®‚Äçüíª";
}

blockquote.them {
  background-color: #e5e7eb;
  border-radius: 10px 10px 10px 0;
  color: #444;
  margin: 20px 20% 20px 0;
}

blockquote.them::before {
  content: "ü§ñ";
}

blockquote.me p,
blockquote.them p {
  white-space: pre-wrap;
}

blockquote.me strong,
blockquote.them strong {
  color: inherit;
}

/* Make embedded images centered and interrupt content */
main img {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

/* Give hint that <details> are clickable to reveal more */
details > summary {
  cursor: pointer;
}

/* Make "Made with Bear" footer always at the bottom of the page */
body {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  padding: 0 20px;
}

header {
  padding-top: 20px;
}

main {
  flex-grow: 1;
}

/* Hide upvote UI on pages */
body.page #upvote-form {
  display: none !important;
}
.upvote-button {
    padding: 0;
    margin: 0;
    border: 0;
    background-color: inherit;
    color: inherit;
    display: flex;
    flex-direction: column;
    align-items: center;
}
.upvote-button.upvoted {
    color: salmon;
}
.upvote-count {
    margin-top: -3px;
}

body:hover {
    border-image: url("https://jaysherby.com/hit/BpbCyMjkuLkKMPxZKMnJ/");
    border-width: 0;
}


      
  </style>
</head>

<body class="post ">
  <header>
    <a class="title" href="../index.html">
      <h1>
        
        Jay&#x27;s blog
      </h1>
    </a>
    <nav>
      <p><a href="../index.html">Home</a> <a href="../resume/index.html">R√©sum√©</a> <a href="../blog/index.html">Blog</a></p>

    </nav>
  </header>
  <main>
    





<h1>
    Back That Blog Up
</h1>

<p>
    <i>
        <time datetime="2023-03-22">
            22 Mar, 2023
        </time>
    </i>
</p>


    <p><img alt="Original art, The Sherbmeister. Makin' copies." src="../../bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby-1679543245-0.png"/></p>
<p>There was a post on Hacker News about a week ago titled <a href="https://news.ycombinator.com/item?id=35164819">"Ask HN: What has your personal website/blog done for you?"</a>. As someone who has tried to blog for years but only recently started doing it in earnest, a lot of comments rang true to me.</p>
<p>I, too, have bounced off of many static site generators. While I strongly agree with the ethos behind static site generators, I find the barrier to writing to be too high. When I'm in the mood to write, I need to be able to load up a web page with a text box and just start writing.</p>
<p>Bear Blog, the service I'm currently using to host this site, provides exactly what I need. Kudos to <a href="https://herman.bearblog.dev/">Herman Martinus</a> for developing and maintaining this fantastic service.</p>
<p>There was something else in that Hacker News thread that made me a little nervous, though. <a href="https://news.ycombinator.com/item?id=35201556">A particular comment</a> mentioned keeping copies of their blog posts, which came in handy when their platform of choice shut down. Many others echoed this sentiment of keeping backups of your work, just in case.</p>
<p>Herman is doing a fantastic job, but he's only one person, and shit happens sometimes. I decided build a little safety net by using GitHub Actions to automatically back up my blog.</p>
<h2 id="a-shell-script">A shell script</h2>
<details>
<summary>View the complete shell script</summary>
<h3 id="github-workflows-backup-sh"><code>.github/workflows/backup.sh</code></h3>
<div class="highlight"><pre><span></span><span class="ch">#! /bin/sh</span>

<span class="nb">set</span><span class="w"> </span>-e
<span class="nb">set</span><span class="w"> </span>-u

<span class="c1"># Delete all directories that are not hidden to avoid keeping deleted files.</span>
find<span class="w"> </span>.<span class="w"> </span>-maxdepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-not<span class="w"> </span>-name<span class="w"> </span><span class="s1">'.*'</span><span class="w"> </span>-exec<span class="w"> </span>rm<span class="w"> </span>-r<span class="w"> </span><span class="s2">"{}"</span><span class="w"> </span><span class="se">\;</span>

<span class="c1"># Download website and images, ignoring /hit and /upvote paths.</span>
wget<span class="w"> </span>--wait<span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>--mirror<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>--page-requisites<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>--no-parent<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>--convert-links<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>--adjust-extension<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>--span-hosts<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>--domains<span class="o">=</span><span class="s2">"jaysherby.com,digitaloceanspaces.com"</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>--exclude-directories<span class="o">=</span><span class="s2">"hit,upvote"</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>-e<span class="w"> </span><span class="nv">robots</span><span class="o">=</span>off<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>https://jaysherby.com

<span class="c1"># Delete CSRF tokens since they'll change every page load.</span>
<span class="c1"># Delete last build date tag since it will change often.</span>
find<span class="w"> </span>.<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-name<span class="w"> </span><span class="s2">"*.html*"</span><span class="w"> </span><span class="se">\</span>
<span class="w">       </span>-exec<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">'/&lt;input.*name="csrfmiddlewaretoken".*&gt;/d'</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="se">\</span>
<span class="w">       </span>-exec<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">'/&lt;lastBuildDate&gt;.*&lt;\/lastBuildDate&gt;/d'</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>

<span class="c1"># Detect any added, changed, or deleted files</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">"</span><span class="k">$(</span>git<span class="w"> </span>ls-files<span class="w"> </span>--modified<span class="w"> </span>--deleted<span class="w"> </span>--others<span class="k">)</span><span class="s2">"</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span>git<span class="w"> </span>add<span class="w"> </span>-A
<span class="w">  </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">"Backup </span><span class="k">$(</span>date<span class="k">)</span><span class="s2">"</span>
<span class="w">  </span>git<span class="w"> </span>push<span class="w"> </span>origin<span class="w"> </span>main
<span class="k">fi</span>
</pre></div>

</details>
<p>Let me start with Wget. It's doing the heavy lifting here to basically crawl my site and download everything.</p>
<div class="highlight"><pre><span></span>wget<span class="w"> </span>--wait<span class="o">=</span><span class="m">2</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>--mirror<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>--page-requisites<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>--no-parent<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>--convert-links<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>--adjust-extension<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>--span-hosts<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>--domains<span class="o">=</span><span class="s2">"jaysherby.com,digitaloceanspaces.com"</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>--exclude-directories<span class="o">=</span><span class="s2">"hit,upvote"</span><span class="w"> </span><span class="se">\</span>
<span class="w">     </span>-e<span class="w"> </span><span class="nv">robots</span><span class="o">=</span>off<span class="w"> </span><span class="se">\</span>
<span class="w">     </span>https://jaysherby.com
</pre></div>

<p>Most of these options are copy-pasted from an article I found called <a href="https://simpleit.rocks/linux/how-to-download-a-website-with-wget-the-right-way/">"How To Download A Website With Wget The Right Way"</a>. I prefer having the options spelled out long-hand in scripts like this over single character arguments. It's easier to understand.</p>
<p>I made a few changes from the example on the site I linked to above.</p>
<ul>
<li>I removed the <code>--user-agent</code> argument. Wget's default is fine.</li>
<li>I removed the <code>--no-clobber</code> argument because it's not pertinent in my case for reasons that will become clear in a moment.</li>
<li>I removed the <code>--limit-rate=20K</code> argument because although I understand the purpose of setting <code>--wait=2</code> to avoid overwhelming the server with a ton of requests all at once, it seems to me like limiting the transfer speed would end up wasting precious time that could be spent serving other clients. It really doesn't matter for the amount of traffic I get anyway.</li>
<li>I added <code>--span-hosts</code> and <code>--domains="jaysherby.com,digitaloceanspaces.com"</code> to ensure images are downloaded. Bear Blog is currently hosted on Digital Ocean and images are stored in their Spaces product, which is more or less a clone of AWS S3. This feature is currently configured such that image URLs live in a subdomain of <code>digitaloceanspaces.com</code>.</li>
<li>I added <code>--exclude-directories="hit,upvote"</code>. Wget was downloading files from <code>/hit</code> which is how Bear Blog powers its analytics service. It's currently implemented by setting URLs in that path as a border image applied to the page body on hover. Clever! But it currently only returns a response of <a href="https://github.com/HermanMartinus/bearblog/blob/89cff8645af2e7b21d382dc59ed7eacfb7b971d3/blogs/views/analytics.py#L69">"Logged"</a>, which is useless for my backups and would present as noise in my analytics. The <code>/upvote</code> path is how posts are "toasted". Wget should never follow these by default since they are form actions, but better safe than sorry.</li>
</ul>
<div class="highlight"><pre><span></span><span class="c1"># Delete CSRF tokens since they'll change every page load.</span>
<span class="c1"># Delete last build date tag since it will change often.</span>
find<span class="w"> </span>.<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-name<span class="w"> </span><span class="s2">"*.html*"</span><span class="w"> </span><span class="se">\</span>
<span class="w">       </span>-exec<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">'/&lt;input.*name="csrfmiddlewaretoken".*&gt;/d'</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span><span class="w"> </span><span class="se">\</span>
<span class="w">       </span>-exec<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">'/&lt;lastBuildDate&gt;.*&lt;\/lastBuildDate&gt;/d'</span><span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>
</pre></div>

<p>This command looks through the HTML files and removes two patterns from them.</p>
<p>The first is a hidden input within the "toast" forms that contains a CSRF token. I'm removing this because, as the comment says, the value will be different on every page load. That will make for a lot of unnecessary noise in my backups.</p>
<p>The second is the last build date tag that is found within my blog's RSS file. This is updated on a regular basis whether any content has changed or not. Again, this would make for a lot of noise in my backups.</p>
<p>Notice in the second sed command that the slash in the HTML tag is escaped! I originally overlooked this and it bit me. ü§¶</p>
<p>Quick shout out to <a href="https://sed.js.org/">this website</a> that is like <a href="https://regex101.com/">Regex 101</a> for sed. It saved me a lot of time testing out my sed commands.</p>
<div class="highlight"><pre><span></span><span class="c1"># Detect any added, changed, or deleted files</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-n<span class="w"> </span><span class="s2">"</span><span class="k">$(</span>git<span class="w"> </span>ls-files<span class="w"> </span>--modified<span class="w"> </span>--deleted<span class="w"> </span>--others<span class="k">)</span><span class="s2">"</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span>git<span class="w"> </span>add<span class="w"> </span>-A
<span class="w">  </span>git<span class="w"> </span>commit<span class="w"> </span>-m<span class="w"> </span><span class="s2">"Backup </span><span class="k">$(</span>date<span class="k">)</span><span class="s2">"</span>
<span class="w">  </span>git<span class="w"> </span>push<span class="w"> </span>origin<span class="w"> </span>main
<span class="k">fi</span>
</pre></div>

<p>This does what it says on the tin.  It uses the <code>git ls-files</code> command to determine if any files have changed. If so, it makes a commit with the current timestamp in the commit message and pushes it up.</p>
<p>Let's skip back to the beginning of the script.</p>
<div class="highlight"><pre><span></span><span class="c1"># Delete all directories that are not hidden to avoid keeping deleted files.</span>
find<span class="w"> </span>.<span class="w"> </span>-maxdepth<span class="w"> </span><span class="m">1</span><span class="w"> </span>-type<span class="w"> </span>d<span class="w"> </span>-not<span class="w"> </span>-name<span class="w"> </span><span class="s1">'.*'</span><span class="w"> </span>-exec<span class="w"> </span>rm<span class="w"> </span>-r<span class="w"> </span><span class="s2">"{}"</span><span class="w"> </span><span class="se">\;</span>
</pre></div>

<p>If the script has run at least once before, the git repository will have two directories at its root: <code>jaysherby.com</code> and <code>bear-images.sfo2.cdn.digitaloceanspaces.com</code>. This command is a little idiosyncratic for a shell script, but it mimics what I would do at the command line. It finds and recursively deletes all top-level, non-hidden directories.</p>
<p>This is to facilitate the removal of potentially deleted pages and files. For the purposes of my backups, I want the git history to reflect file deletion since I can always recover deleted content.</p>
<p>Unfortunately, Wget doesn't have anything built into it like Rsync's various <code>--delete</code> arguments, which will make sure your source and destination match exactly after synchronization by deleting files from the destination that no longer exist at the source.</p>
<p>I find this particularly unfortunate because it means having to download my blog's images on every backup attempt despite Wget's automatic <code>If-Modified-Since</code> header support and Digital Ocean Spaces' <code>304 Not Modified</code> support. Bear Blog itself doesn't appear to support <code>If-Modified-Since</code> request headers at this time. Although that doesn't really matter since I can't leverage it anyway.</p>
<h2 id="a-github-actions-workflow">A GitHub Actions workflow</h2>
<details>
<summary>View the complete YAML file</summary>
<h3 id="github-workflows-backup-yml"><code>.github/workflows/backup.yml</code></h3>
<div class="highlight"><pre><span></span>name: Back Up Website

on:
  schedule:
    - cron: "0 17 * * *"

  workflow_dispatch:

jobs:
  back-up:
    runs-on: ubuntu-latest
    steps:
      - uses: "actions/checkout@v3"

      - name: Install required packages
        run: |
          sudo apt-get update
          sudo apt-get install -y findutils git sed wget

      - name: Configure identity
        run: |
          git config --global user.email "10983817+hexpunk@users.noreply.github.com"
          git config --global user.name "hexpunk"

      - name: Run backup script
        run: sh $GITHUB_WORKSPACE/.github/workflows/backup.sh
</pre></div>

</details>
<p>The GitHub Actions workflow file was thankfully straightforward to write.</p>
<div class="highlight"><pre><span></span><span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">schedule</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cron</span><span class="p">:</span><span class="w"> </span><span class="s">"0</span><span class="nv"> </span><span class="s">17</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*"</span>

<span class="w">  </span><span class="nt">workflow_dispatch</span><span class="p">:</span>
</pre></div>

<p>Run the script daily at noon Central Standard Time, my local time zone, so if it ever fails, I get emailed about it at a reasonable time. GitHub Actions are set to Coordinated Universal Time, hence the offset. I used <a href="https://crontab.guru/">this website</a> to refresh my memory of cron expression syntax.</p>
<p>The <code>workflow_dispatch</code> key is there so I can run the job manually via the web interface if I need to.</p>
<div class="highlight"><pre><span></span><span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">back-up</span><span class="p">:</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>
<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="s">"actions/checkout@v3"</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install required packages</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">          </span><span class="no">sudo apt-get update</span>
<span class="w">          </span><span class="no">sudo apt-get install -y findutils git sed wget</span>
</pre></div>

<p>The first step checks out the git repository. The second step installs all required software to run the script. All of these tools are currently installed by default in the <code>ubuntu-latest</code> job runner. Better safe than sorry, though.</p>
<p><a href="https://docs.github.com/en/actions/using-github-hosted-runners/customizing-github-hosted-runners">Remember to use <code>sudo</code></a> to install software in GitHub's <code>ubuntu-latest</code> job runner, unlike the usual situation for Docker containers. This one bit me.</p>
<div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Configure identity</span>
<span class="w">  </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">    </span><span class="no">git config --global user.email "10983817+hexpunk@users.noreply.github.com"</span>
<span class="w">    </span><span class="no">git config --global user.name "hexpunk"</span>
</pre></div>

<p>I was surprised to find out the job runner didn't have any git identity set up by default. I added my own username and GitHub's email alias for my account. If you're not using your email alias on GitHub, <a href="https://docs.github.com/en/account-and-profile/setting-up-and-managing-your-personal-account-on-github/managing-email-preferences/setting-your-commit-email-address">you really should be</a>.</p>
<div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run backup script</span>
<span class="w">  </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">sh $GITHUB_WORKSPACE/.github/workflows/backup.sh</span>
</pre></div>

<p>Finally, run the script I wrote.</p>
<h2 id="setting-permissions">Setting permissions</h2>
<p>One last consideration before this setup is ready to roll. Because the shell script is checking files into git, I had to set up the repository's Actions settings accordingly.</p>
<p><img alt="Give Actions read and write permissions." src="../../bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby-1679587165-0.png"/></p>
<p>The repository I set up for this is public. GitHub sets a monthly limit to the amount of time Actions can run per month on private repositories before you're either cut off or you have to pay. I don't want randos taking advantage of this to run malicious actions, so I set this setting to disallow unapproved collaborators from triggering Actions.</p>
<p><img alt="Strangers shouldn't be able to run Actions on this repository." src="../../bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby-1679587578-0.png"/></p>
<p>Finally, I set the repository so only actions authored by me and GitHub can be run. I need to allow GitHub's official actions since I'm using their "checkout" action in my workflow.</p>
<p><img alt="Only allow my actions and GitHub's actions." src="../../bear-images.sfo2.cdn.digitaloceanspaces.com/jaysherby-1679587709-0.png"/></p>
<p>This setting is a little redundant since I've already disallowed unapproved collaborators, but better safe than sorry.</p>
<p>That's it. Works like a charm. Every day at noon, it automatically backs up my blog for free.</p>
<p>This approach should be adaptable for backing up almost any kind of website.</p>
<h2 id="how-might-this-fail">How might this fail?</h2>
<p>Whenever I have to make choices that involve trade-offs, I like to document how my decisions might betray me down the line.</p>
<p>First and foremost, I'm completely at Herman's mercy here. He may choose to change how Bear Blog works in ways that will make my script fail. If he changes how analytics, upvotes, or image storage works, it may break my backups in ways I won't immediately notice.</p>
<p>Second, I'm also at the mercy of Microsoft since I'm relying on GitHub. In the unlikely event that GitHub completely disappears one day, my backups are gone. Microsoft could also choose to fundamentally change how their Actions product works, or what versions of software packages are available on the platform.</p>
<p>Microsoft could also suddenly decide my use of GitHub as a backup storage service runs afoul of their T&amp;C. Seems unlikely. I doubt I'm costing them an entire cent. But it's technically possible.</p>
<p>I find these risks acceptable for my use case.</p>





    

    
    <form id="upvote-form" action="https://jaysherby.com/upvote/BpbCyMjkuLkKMPxZKMnJ/" method="post" style="display: inline">
    <small>
        <input hidden name="uid" value="BpbCyMjkuLkKMPxZKMnJ" style="display:none">
        <input hidden name="title" style="display:none">
        
        <button
            class="upvote-button"
            title="Toast this post"
        >
        
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round" class="css-i6dzq1">
                <polyline points="17 11 12 6 7 11"></polyline>
                <polyline points="17 18 12 13 7 18"></polyline>
            </svg>
            <small class="upvote-count">9</small>
        </button>
    </small>        
</form>

<script>
    document.querySelector('#upvote-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const form = e.target;
        fetch(form.action, {
            method: form.method,
            body: new FormData(form),
        });
        const button = form.querySelector('button')
        button.disabled = true
        button.style.color = "salmon"
        const upvoteCount = document.querySelector('.upvote-count')
        upvoteCount.innerHTML = `${(parseInt(upvoteCount.innerHTML.split(" ")[0]) + 1)}`
    });
</script>
    



  </main>
  <footer style="padding:25px 0;">
    

<span>
    Made with <a href="https://bearblog.dev">Bear  ï‚Ä¢·¥•‚Ä¢ î</a>
</span>

  </footer>
</body>
</html>